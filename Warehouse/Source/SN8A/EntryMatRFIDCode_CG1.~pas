unit EntryMatRFIDCode_CG1;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, DB, DBTables, GridsEh, DBGridEh, StdCtrls, ExtCtrls;

type
  TEntryMatRFIDCode_CG = class(TForm)
    Panel1: TPanel;
    Label1: TLabel;
    Label2: TLabel;
    Button1: TButton;
    CLBHEdit: TEdit;
    CGNOEdit: TEdit;
    DBGridEh1: TDBGridEh;
    DS1: TDataSource;
    Query1: TQuery;
    Query1CGNO: TStringField;
    Query1CLBH: TStringField;
    Query1YWPM: TStringField;
    Query1Qty: TCurrencyField;
    Query1ZSYWJC: TStringField;
    procedure FormDestroy(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure DBGridEh1DblClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  EntryMatRFIDCode_CG: TEntryMatRFIDCode_CG;

implementation

uses EntryMatRFIDCode1,main1,FunUnit;

{$R *.dfm}

procedure TEntryMatRFIDCode_CG.FormDestroy(Sender: TObject);
begin
  EntryMatRFIDCode_CG:=nil;
end;

procedure TEntryMatRFIDCode_CG.Button1Click(Sender: TObject);
begin
  if ((CGNOEdit.Text='') and (CLBHEdit.Text='')) then
  begin
    Showmessage('Xin nhap PO.NO hoac MatID ');
    Exit;
  end;
  //
  with query1 do
  begin
    Active:=false;
    SQL.Clear;
    SQL.Add('select CGZLS.CGNO,CGZLS.CLBH,CGZLS.Qty,CLZL.YWPM,ZSZL.ZSYWJC');
    SQL.Add('from CGZLS ');
    SQL.Add('left join CGZL on CGZL.CGNO=CGZLS.CGNO');
    SQL.Add('left join CLZL on CLZL.CLDH=CGZLS.CLBH');
    SQL.Add('left join ZSZL on CGZL.ZSBH=ZSZL.ZSDH');
    SQL.Add('where 1=1 ');
    if CGNOEdit.Text<>'' then
    SQL.Add('   and CGZL.CGNO like '''+CGNOEdit.Text+'%'' ');
    if CLBHEdit.Text<>'' then
    SQl.Add('   and CGZLS.CLBH like '''+CLBHEdit.Text+'%'' ');
    SQL.Add('   and CGZL.GSBH='''+main.Edit2.Text+''' ');
    SQL.Add('Group by CGZLS.CGNO,CGZLS.CLBH,CGZLS.Qty,CLZL.YWPM,ZSZL.ZSYWJC');
    SQL.Add('order by CGZLS.CLBH ');
    //funcObj.WriteErrorLog(sql.Text);
    Active:=true;
  end;
  //
end;

procedure TEntryMatRFIDCode_CG.DBGridEh1DblClick(Sender: TObject);
begin
  if (not query1.Active) then
  begin
    abort;
  end;
  if (Query1.recordcount<1) then
  begin
    abort;
  end;
  with EntryMatRFIDCode.KCRKRFS do
  begin
    insert;
    fieldbyname('CGNO').value:=query1.fieldbyname('CGNO').value;
    fieldbyname('CLBH').value:=query1.fieldbyname('CLBH').value;
    fieldbyname('YWPM').value:=query1.fieldbyname('YWPM').value;
    fieldbyname('Qty').value:=0.0;
    fieldbyname('PackQty').value:=100.0;
    post;
  end;
  showmessage('Succeed.');
end;

end.
