object DetailInSampleOrder: TDetailInSampleOrder
  Left = 593
  Top = 317
  Width = 1686
  Height = 727
  Caption = 'DetailInSampleOrder'
  Color = clBtnFace
  Font.Charset = DEFAULT_CHARSET
  Font.Color = clWindowText
  Font.Height = -13
  Font.Name = 'MS Sans Serif'
  Font.Style = []
  FormStyle = fsMDIChild
  OldCreateOrder = False
  Position = poDefault
  Visible = True
  WindowState = wsMaximized
  OnClose = FormClose
  OnCreate = FormCreate
  OnDestroy = FormDestroy
  PixelsPerInch = 96
  TextHeight = 16
  object PageControl1: TPageControl
    Left = 0
    Top = 0
    Width = 1670
    Height = 688
    ActivePage = TabSheet1
    Align = alClient
    TabOrder = 0
    object TabSheet1: TTabSheet
      Caption = 'SampleOrder'
      object Splitter2: TSplitter
        Left = 0
        Top = 257
        Width = 1662
        Height = 8
        Cursor = crVSplit
        Align = alTop
      end
      object Panel6: TPanel
        Left = 0
        Top = 0
        Width = 1662
        Height = 105
        Align = alTop
        TabOrder = 0
        object Label7: TLabel
          Left = 4
          Top = 19
          Width = 70
          Height = 16
          Alignment = taRightJustify
          AutoSize = False
          Caption = 'YPDH:'
        end
        object Label8: TLabel
          Left = 213
          Top = 19
          Width = 70
          Height = 16
          Alignment = taRightJustify
          AutoSize = False
          Caption = 'MatNo:'
        end
        object Label9: TLabel
          Left = 405
          Top = 17
          Width = 70
          Height = 16
          Alignment = taRightJustify
          AutoSize = False
          Caption = 'Ma HG:'
        end
        object SpeedButton1: TSpeedButton
          Left = 184
          Top = 16
          Width = 23
          Height = 22
          Caption = '...'
          OnClick = SpeedButton1Click
        end
        object Label1: TLabel
          Left = 568
          Top = 17
          Width = 70
          Height = 16
          Alignment = taRightJustify
          AutoSize = False
          Caption = 'Ma HD:'
        end
        object Label3: TLabel
          Left = 40
          Top = 56
          Width = 41
          Height = 16
          Caption = 'Ty gia:'
        end
        object RYEdit: TEdit
          Left = 77
          Top = 15
          Width = 108
          Height = 24
          CharCase = ecUpperCase
          Color = clYellow
          TabOrder = 0
          OnKeyUp = RYEditKeyUp
        end
        object Button4: TButton
          Left = 820
          Top = 8
          Width = 81
          Height = 33
          Caption = 'Excel'
          Font.Charset = DEFAULT_CHARSET
          Font.Color = clWindowText
          Font.Height = -13
          Font.Name = 'MS Sans Serif'
          Font.Style = [fsBold]
          ParentFont = False
          TabOrder = 1
          OnClick = Button4Click
        end
        object Button5: TButton
          Left = 737
          Top = 7
          Width = 81
          Height = 34
          Caption = 'Ma HG'
          Font.Charset = DEFAULT_CHARSET
          Font.Color = clWindowText
          Font.Height = -13
          Font.Name = 'MS Sans Serif'
          Font.Style = [fsBold]
          ParentFont = False
          TabOrder = 2
          OnClick = Button5Click
        end
        object Button6: TButton
          Left = 904
          Top = 8
          Width = 89
          Height = 33
          Caption = 'Ma Vat Tu'
          Font.Charset = DEFAULT_CHARSET
          Font.Color = clWindowText
          Font.Height = -13
          Font.Name = 'MS Sans Serif'
          Font.Style = [fsBold]
          ParentFont = False
          TabOrder = 3
          OnClick = Button6Click
        end
        object MatEdit: TEdit
          Left = 287
          Top = 15
          Width = 108
          Height = 24
          CharCase = ecUpperCase
          Color = clWhite
          TabOrder = 4
        end
        object HGEdit: TEdit
          Left = 480
          Top = 13
          Width = 86
          Height = 24
          TabOrder = 5
        end
        object CK2: TCheckBox
          Left = 1004
          Top = 16
          Width = 229
          Height = 17
          Caption = 'hien thay hoa chat'
          Checked = True
          State = cbChecked
          TabOrder = 6
        end
        object HDEdit: TEdit
          Left = 643
          Top = 13
          Width = 70
          Height = 24
          TabOrder = 7
        end
        object Edit2: TEdit
          Left = 101
          Top = 55
          Width = 108
          Height = 24
          CharCase = ecUpperCase
          Color = clWhite
          TabOrder = 8
        end
        object Button7: TButton
          Left = 231
          Top = 48
          Width = 86
          Height = 33
          Caption = 'XNK_TT'
          Font.Charset = DEFAULT_CHARSET
          Font.Color = clWindowText
          Font.Height = -13
          Font.Name = 'MS Sans Serif'
          Font.Style = [fsBold]
          ParentFont = False
          TabOrder = 9
          OnClick = Button7Click
        end
      end
      object DBGridEh5: TDBGridEh
        Left = 0
        Top = 105
        Width = 1662
        Height = 152
        Align = alTop
        DataSource = HGDS
        Flat = False
        FooterColor = clWindow
        FooterFont.Charset = DEFAULT_CHARSET
        FooterFont.Color = clWindowText
        FooterFont.Height = -13
        FooterFont.Name = 'MS Sans Serif'
        FooterFont.Style = []
        FooterRowCount = 1
        SumList.Active = True
        TabOrder = 1
        TitleFont.Charset = DEFAULT_CHARSET
        TitleFont.Color = clWindowText
        TitleFont.Height = -13
        TitleFont.Name = 'MS Sans Serif'
        TitleFont.Style = []
        UseMultiTitle = True
        OnGetCellParams = DBGridEh5GetCellParams
        Columns = <
          item
            EditButtons = <>
            FieldName = 'ZLBH'
            Footers = <>
            Title.Caption = #26448#26009#32232#34399'|ZLBH'
            Width = 75
          end
          item
            EditButtons = <>
            FieldName = 'HG_NO'
            Footer.ValueType = fvtCount
            Footers = <>
            Title.Caption = #28023#38364#20195#30908'|CNO'
            Width = 56
          end
          item
            EditButtons = <>
            FieldName = 'TC_NO'
            Footers = <>
            Title.Caption = #28023#38364#20195#30908'|Ma TC'
            Width = 71
          end
          item
            EditButtons = <>
            FieldName = 'HD_NO'
            Footers = <>
            Title.Caption = #28023#38364#20195#30908'|Ma HD'
            Width = 70
          end
          item
            EditButtons = <>
            FieldName = 'KD_NO'
            Footers = <>
            Title.Caption = #28023#38364#20195#30908'|Ma KD'
            Width = 76
          end
          item
            EditButtons = <>
            FieldName = 'Usage'
            Footers = <>
            Visible = False
          end
          item
            EditButtons = <>
            FieldName = 'CLSL'
            Footer.ValueType = fvtSum
            Footers = <>
            Title.Caption = #29992#37327'|CLSL'
            Width = 63
          end
          item
            EditButtons = <>
            FieldName = 'Qty'
            Footer.ValueType = fvtSum
            Footers = <>
            Title.Caption = #23526#38936'|Qty'
            Width = 65
          end
          item
            EditButtons = <>
            FieldName = 'NK'
            Footers = <>
            Title.Caption = #25976#37327'|NK'
          end
          item
            EditButtons = <>
            FieldName = 'TC'
            Footers = <>
            Title.Caption = #25976#37327'|TC'
          end
          item
            EditButtons = <>
            FieldName = 'HD'
            Footers = <>
            Title.Caption = #25976#37327'|HD'
          end
          item
            EditButtons = <>
            FieldName = 'KD'
            Footers = <>
            Title.Caption = #25976#37327'|KD'
          end
          item
            EditButtons = <>
            FieldName = 'XT'
            Footers = <>
            Title.Caption = #25976#37327'|XT'
          end
          item
            EditButtons = <>
            FieldName = 'GC'
            Footers = <>
            Title.Caption = #25976#37327'|GC'
            Width = 65
          end
          item
            EditButtons = <>
            FieldName = 'ZZ'
            Footers = <>
            Title.Caption = #25976#37327'|ZZ'
            Width = 58
          end>
      end
      object DBGridEh4: TDBGridEh
        Left = 0
        Top = 265
        Width = 1662
        Height = 392
        Align = alClient
        DataSource = RYDS
        Flat = False
        FooterColor = clWindow
        FooterFont.Charset = DEFAULT_CHARSET
        FooterFont.Color = clWindowText
        FooterFont.Height = -13
        FooterFont.Name = 'MS Sans Serif'
        FooterFont.Style = []
        FooterRowCount = 1
        OptionsEh = [dghFixed3D, dghHighlightFocus, dghClearSelection, dghAutoSortMarking, dghDialogFind]
        PopupMenu = PopupMenu3
        SumList.Active = True
        TabOrder = 2
        TitleFont.Charset = DEFAULT_CHARSET
        TitleFont.Color = clWindowText
        TitleFont.Height = -13
        TitleFont.Name = 'MS Sans Serif'
        TitleFont.Style = []
        UseMultiTitle = True
        OnDrawColumnCell = DBGridEh4DrawColumnCell
        OnGetCellParams = DBGridEh4GetCellParams
        Columns = <
          item
            EditButtons = <>
            FieldName = 'ZLBH'
            Footers = <>
            Title.Caption = #35330#21934#32232#34399'|ZLBH'
            Title.TitleButton = True
            Width = 82
          end
          item
            EditButtons = <>
            FieldName = 'DType'
            Footers = <>
            Title.Caption = #21152#24037'|DType'
            Title.TitleButton = True
          end
          item
            EditButtons = <>
            FieldName = 'CLBH'
            Footer.ValueType = fvtCount
            Footers = <>
            Title.Caption = #26448#26009#32232#34399'|CLBH'
            Title.TitleButton = True
            Width = 80
          end
          item
            EditButtons = <>
            FieldName = 'YWPM'
            Footers = <>
            Title.Caption = #26448#26009#21517#31281'|YWPM'
            Title.TitleButton = True
            Width = 170
          end
          item
            EditButtons = <>
            FieldName = 'DWBH'
            Footers = <>
            Title.Caption = #21934#20301'|DWBH'
            Title.TitleButton = True
            Width = 45
          end
          item
            EditButtons = <>
            FieldName = 'CLSL'
            Footer.ValueType = fvtSum
            Footers = <>
            Title.Caption = #29992#37327'|CLSL'
            Title.TitleButton = True
            Width = 61
          end
          item
            EditButtons = <>
            FieldName = 'TempQty'
            Footer.ValueType = fvtSum
            Footers = <>
            Title.Caption = #38936#26009'|TempQty'
            Title.TitleButton = True
            Width = 57
          end
          item
            EditButtons = <>
            FieldName = 'Qty'
            Footer.ValueType = fvtSum
            Footers = <>
            Title.Caption = #23526#30332'|Qty'
            Title.TitleButton = True
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'Person'
            Footers = <>
            Title.Caption = #27604#29575'|Person'
            Width = 53
          end
          item
            EditButtons = <>
            FieldName = 'Quantity'
            Footers = <>
            Title.Caption = #38617#25976'|Quantity'
            Title.TitleButton = True
            Width = 53
          end
          item
            EditButtons = <>
            FieldName = 'HG_NO'
            Footers = <>
            Title.Caption = 'NK|Ma HQ'
            Title.TitleButton = True
            Width = 62
          end
          item
            EditButtons = <>
            FieldName = 'Rate_HG'
            Footers = <>
            Title.Caption = 'NK|Rate'
            Title.TitleButton = True
            Width = 60
          end
          item
            EditButtons = <>
            FieldName = 'TC_NO'
            Footers = <>
            Title.Caption = 'TC|Ma HQ'
            Width = 48
          end
          item
            EditButtons = <>
            FieldName = 'Rate_TC'
            Footers = <>
            Title.Caption = 'TC|Rate'
            Width = 56
          end
          item
            EditButtons = <>
            FieldName = 'HD_NO'
            Footers = <>
            Title.Caption = 'HD|Ma HQ'
            Width = 57
          end
          item
            EditButtons = <>
            FieldName = 'Rate_HD'
            Footers = <>
            Title.Caption = 'HD|Rate'
            Width = 58
          end
          item
            EditButtons = <>
            FieldName = 'KD_NO'
            Footers = <>
            Title.Caption = 'KD|Ma HQ'
            Width = 56
          end
          item
            EditButtons = <>
            FieldName = 'Rate_KD'
            Footers = <>
            Title.Caption = 'KD|Rate'
            Width = 56
          end
          item
            EditButtons = <>
            FieldName = 'NK'
            Footers = <>
            Title.Caption = #25976#37327'|NK'
            Title.TitleButton = True
            Width = 40
          end
          item
            EditButtons = <>
            FieldName = 'TC'
            Footers = <>
            Title.Caption = #25976#37327'|TC'
            Width = 43
          end
          item
            EditButtons = <>
            FieldName = 'HD'
            Footers = <>
            Title.Caption = #25976#37327'|HD'
            Title.TitleButton = True
            Width = 42
          end
          item
            EditButtons = <>
            FieldName = 'KD'
            Footers = <>
            Title.Caption = #25976#37327'|KD'
            Title.TitleButton = True
            Width = 40
          end
          item
            EditButtons = <>
            FieldName = 'XT'
            Footers = <>
            Title.Caption = #25976#37327'|XT'
            Title.TitleButton = True
            Width = 38
          end
          item
            EditButtons = <>
            FieldName = 'GC'
            Footers = <>
            Title.Caption = #25976#37327'|GC'
            Title.TitleButton = True
            Width = 39
          end
          item
            EditButtons = <>
            FieldName = 'ZZ'
            Footers = <>
            Title.Caption = #25976#37327'|ZZ'
            Title.TitleButton = True
            Width = 41
          end
          item
            EditButtons = <>
            FieldName = 'RKQty'
            Footers = <>
            Title.Caption = #25976#37327'|RKQty'
            Title.TitleButton = True
            Width = 44
          end
          item
            EditButtons = <>
            FieldName = 'THQty'
            Footers = <>
            Title.Caption = #36864#24235'|THQty'
            Width = 46
          end
          item
            EditButtons = <>
            FieldName = 'HG1_NO'
            Footers = <>
            Title.Caption = 'NK1|Ma HQ'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'Rate_HG1'
            Footers = <>
            Title.Caption = 'NK1|Rate'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'TC1_NO'
            Footers = <>
            Title.Caption = 'TC1|Ma HQ'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'Rate_TC1'
            Footers = <>
            Title.Caption = 'TC1|Rate'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'HD1_NO'
            Footers = <>
            Title.Caption = 'HD1|Ma HQ'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'Rate_HD1'
            Footers = <>
            Title.Caption = 'HD1|Rate'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'KD1_NO'
            Footers = <>
            Title.Caption = 'KD1|Ma HQ'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'Rate_KD1'
            Footers = <>
            Title.Caption = 'KD1|Rate'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'NQ_NO'
            Footers = <>
            Title.Caption = 'NQ|Ma NQ'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'Rate_NQ'
            Footers = <>
            Title.Caption = 'NQ|Rate'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'NKNQ_NO'
            Footers = <>
            Title.Caption = 'NKNQ|Ma HQ'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'Rate_NKNQ'
            Footers = <>
            Title.Caption = 'NKNQ|Rate'
            Width = 50
          end
          item
            EditButtons = <>
            FieldName = 'NK1'
            Footers = <>
            Title.Caption = #25976#37327'|NK1'
            Width = 40
          end
          item
            EditButtons = <>
            FieldName = 'TC1'
            Footers = <>
            Title.Caption = #25976#37327'|TC1'
            Width = 40
          end
          item
            EditButtons = <>
            FieldName = 'HD1'
            Footers = <>
            Title.Caption = #25976#37327'|HD1'
            Width = 40
          end
          item
            EditButtons = <>
            FieldName = 'KD1'
            Footers = <>
            Title.Caption = #25976#37327'|KD1'
            Width = 40
          end
          item
            EditButtons = <>
            FieldName = 'H11'
            Footers = <>
            Title.Caption = #25976#37327'|H11'
            Width = 40
          end
          item
            EditButtons = <>
            FieldName = 'NQ'
            Footers = <>
            Title.Caption = #25976#37327'|NQ'
            Width = 40
          end
          item
            EditButtons = <>
            FieldName = 'NKNQ'
            Footers = <>
            Title.Caption = #25976#37327'|NKNQ'
            Width = 45
          end
          item
            EditButtons = <>
            FieldName = 'LLMemo'
            Footers = <>
            Width = 70
          end
          item
            EditButtons = <>
            FieldName = 'Article'
            Footers = <>
            Title.Caption = 'SKU|Article'
            Title.TitleButton = True
            Width = 80
          end
          item
            EditButtons = <>
            FieldName = 'XieMing'
            Footers = <>
            Title.Caption = #38795#21517'|XieMing'
            Title.TitleButton = True
            Width = 110
          end
          item
            EditButtons = <>
            FieldName = 'CalDate'
            Footers = <>
            Title.Caption = #35336#31639#26085#26399'|CalDate'
            Title.TitleButton = True
            Width = 81
          end
          item
            EditButtons = <>
            FieldName = 'GSBH'
            Footers = <>
            Title.Caption = #24288#21029'|GSBH'
            Title.TitleButton = True
            Width = 45
          end>
      end
    end
  end
  object HGQuery: TQuery
    DatabaseName = 'DB'
    SQL.Strings = (
      ''
      'Select HG_NO,TC_NO,HD_NO,KD_NO'
      
        '       ,Max(HG_HGPM) as HG_HGPM,Max(HG_Unit) as HG_Unit,Max(TC_H' +
        'GPM) as TC_HGPM,Max(TC_Unit) as TC_Unit,Max(HD_HGPM) as HD_HGPM,' +
        'Max(HD_Unit) as HD_Unit '
      '       ,Max(KD_HGPM) as KD_HGPM,Max(KD_Unit) as KD_Unit '
      
        '       ,Round(Round(Sum(CLSL)/Max(Quantity),6)*IsNull(Max(Rate_H' +
        'G),1),6) as CLSL '
      
        '       ,Round(Round(Sum(Qty)/Max(Quantity),6)*IsNull(Max(Rate_HG' +
        '),1),6) as Qty '
      
        '       ,Round(Round(Sum(NK)/Max(Quantity),6)*IsNull(Max(Rate_HG)' +
        ',1),6) as NK '
      
        '       ,Round(Round(Sum(TC)/Max(Quantity),6)*IsNull(Max(Rate_TC)' +
        ',1),6) as TC '
      
        '       ,Round(Round(Sum(HD)/Max(Quantity),6)*IsNull(Max(Rate_HD)' +
        ',1),6) as HD '
      
        '       ,Round(Round(Sum(KD)/Max(Quantity),6)*IsNull(Max(Rate_KD)' +
        ',1),6) as KD '
      
        '       ,Round(Round(Sum(XT)/Max(Quantity),6)*IsNull(Max(Rate_HG)' +
        ',1),6) as XT '
      
        '       ,Round(Round(Sum(GC)/Max(Quantity),6)*IsNull(Max(Rate_HG)' +
        ',1),6) as GC '
      
        '       ,Round(Round(Sum(ZZ)/Max(Quantity),6)*IsNull(Max(Rate_HG)' +
        ',1),6) as ZZ '
      'from ('
      
        'Select ZLZLS2.ZLBH,ZLZLS2.MJBH,ZLZLS2.Parent,ZLZLS2.DType,ZLZLS2' +
        '.CLBH,ZLZLS2.CLSL,ZLZLS2.YWPM,ZLZLS2.dwbh,ZLZLS2.ARTICLE,ZLZLS2.' +
        'XieMing,ZLZLS2.Quantity,ZLZLS2.CalDate,ZLZLS2.GSBH,ZLZLS2.TempQt' +
        'y,ZLZLS2.RKQty '
      
        '       ,ZLZLS2.NK,ZLZLS2.TC,ZLZLS2.HD,ZLZLS2.KD,ZLZLS2.XT,ZLZLS2' +
        '.GC,ZLZLS2.ZZ,ZLZLS2.Qty '
      
        '       ,CLHG.RateC as Rate_HG,case when (ZLZLS2.NK>0)  then IsNu' +
        'll(CNO_NK,CLHG.HGBH) else null end as HG_NO,CLHG.HGPM as HG_HGPM' +
        ',CLHG.UnitC as HG_Unit '
      
        '       ,CLTC.RateC as Rate_TC,case when (ZLZLS2.TC>0)  then IsNu' +
        'll(CNO_TC,CLTC.HGBH) else null end as TC_NO,CLTC.HGPM as TC_HGPM' +
        ',CLTC.UnitC as TC_Unit '
      
        '       ,CLHD.RateC as Rate_HD,case when (ZLZLS2.HD>0)  then IsNu' +
        'll(CNO_HD,CLHD.HGBH) else null end as HD_NO,CLHD.HGPM as HD_HGPM' +
        ',CLHD.UnitC as HD_Unit  '
      
        '       ,CLKD.RateC as Rate_KD,case when (ZLZLS2.KD>0)  then IsNu' +
        'll(CNO_KD,CLKD.HGBH) else null end as KD_NO,CLKD.HGPM as KD_HGPM' +
        ',CLKD.UnitC as KD_Unit  '
      '       ,KCRKTH.Qty as THQty from ('
      
        'select OrdCL.*,Round(KCLLS.TempQty,2) as TempQty ,case when KCLL' +
        'S.CNO_NK='#39#39' then null else CNO_NK end CNO_NK,case when KCLLS.CNO' +
        '_TC='#39#39' then null else CNO_TC end CNO_TC'
      
        ',case when KCLLS.CNO_HD='#39#39' then null else CNO_HD end CNO_HD,case' +
        ' when KCLLS.CNO_KD='#39#39' then null else CNO_KD end CNO_KD,KCLLS.RKQ' +
        'ty,'
      
        '       IsNull(KCLLS.NK,0) as NK,IsNull(KCLLS.TC,0) as TC,IsNull(' +
        'KCLLS.HD,0) as HD,IsNull(KCLLS.KD,0) as KD,IsNull(KCLLS.XT,0) as' +
        ' XT,IsNull(KCLLS.GC,0) as GC,'
      
        '       IsNull(Round(KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.TC' +
        ',0)-IsNull(KCLLS.HD,0)-IsNull(KCLLS.KD,0)-IsNull(KCLLS.XT,0)-IsN' +
        'ull(KCLLS.GC,0),2),0)  as ZZ,KCLLS.Qty '
      
        'from (select * from (select YPZLS.YPDH as ZLBH,YPZLS.MJBH,YPZLS.' +
        'Parent,YPZLS.DType,YPZLS.CLBH, YPZLS.CLSL, '
      
        '      CLZL.YWPM,CLZL.DWBH,KFXXZL.Article,KFXXZL.XieMing,YPZL.Qua' +
        'ntity ,YPZL.USERDATE as CalDate,YPZL.GSDH as GSBH  from ( '
      
        '      Select YPZLS.YPDH, YPZLS.MJBH, YPZLS.Parent, YPZLS.DType, ' +
        'YPZLS.CLBH,YPZLS.CLZMLB,Sum(YPZLS.CLSL) as CLSL from ( '
      
        '      SELECT ypzls.YPDH ,ypzls.xh,ypzls.CLBH as MJBH,ypzls.CLBH ' +
        'as Parent ,'#39'Assembly'#39' as DType,ypzls.CLBH,CEILING(ypzls.CLSL*YPZ' +
        'L.Quantity*100)/100 as CLSL,clzl.CLZMLB '
      '      FROM ypzls ypzls '
      '      LEFT JOIN YPZL on YPZL.YPDH=YPZLS.YPDH '
      '      LEFT JOIN clzl clzl ON ypzls.CLBH = clzl.cldh '
      
        '      left join YPZL_NoNeedPart on YPZL_NoNeedPart.BWBH=ypzls.BW' +
        'BH'
      '      WHERE YPZLS.YPDH = '#39'Y2203-0555'#39' '
      '            and CLZL.CLDH like '#39'W126000003%'#39' '
      '            and YPZL_NoNeedPart.bwbh is null'
      '      union all '
      
        '      SELECT ypzls.YPDH ,ypzls.xh  ,clzhzl.cldh as MJBH,ypzls.cl' +
        'bh as Parent,'#39'Gia cong'#39' as DType,clzhzl.CLDH1 as CLBH ,Round((CE' +
        'ILING(YPZLS.CLSL*YPZL.Quantity*100)/100)*CLZHZL.SYL,2) as CLSL,c' +
        'lzl.CLZMLB '
      '      FROM ypzls ypzls '
      '      LEFT JOIN YPZL on YPZL.YPDH=YPZLS.YPDH '
      '      Left join clzhzl ON  ypzls.CLBH = CLZHZL.cldh '
      '      LEFT JOIN clzl clzl ON CLZHZL.cldh1 = clzl.cldh '
      
        '      left join YPZL_NoNeedPart on YPZL_NoNeedPart.BWBH=ypzls.BW' +
        'BH'
      '      WHERE YPZLS.YPDH = '#39'Y2203-0555'#39'  and CLZHZL.SYL>0  '
      '            and CLZL.CLDH like '#39'W126000003%'#39' '
      '            and YPZL_NoNeedPart.bwbh is null'
      '      union all'
      
        '      Select clzhzl2.YPDH,clzhzl2.XH,clzhzl.CLDH as MJBH,clzhzl2' +
        '.Parent,clzhzl2.DType ,clzhzl.CLDH1 as CLBH,Round(clzhzl2.CLSL*c' +
        'lzhzl.syl,2) as CLSL,clzl.clzmlb '
      '       from ('
      
        '      SELECT ypzls.YPDH ,ypzls.xh  ,YPZLS.CLBH as Parent,'#39'Gia co' +
        'ng'#39' as DType,clzhzl.CLDH1 as CLBH,Round((CEILING(YPZLS.CLSL*YPZL' +
        '.Quantity*100)/100)*CLZHZL.SYL,2) as CLSL '
      '      FROM ypzls ypzls '
      '      LEFT JOIN YPZL on YPZL.YPDH=YPZLS.YPDH '
      '      inner join clzhzl ON  ypzls.CLBH = CLZHZL.cldh '
      '      left JOIN clzl clzl ON CLZHZL.cldh1 = clzl.cldh '
      
        '      left join YPZL_NoNeedPart on YPZL_NoNeedPart.BWBH=ypzls.BW' +
        'BH'
      
        '      WHERE YPZLS.YPDH = '#39'Y2203-0555'#39'  and CLZHZL.SYL>0   and cl' +
        'zl.clzmlb='#39'Y'#39' and YPZL_NoNeedPart.bwbh is null'
      '      ) clzhzl2'
      '      inner join clzhzl ON  clzhzl2.CLBH = CLZHZL.cldh '
      '      left JOIN clzl clzl ON CLZHZL.cldh1 = clzl.cldh '
      '      where  CLZL.CLDH like '#39'W126000003%'#39' '
      
        '      )  YPZLS Group by YPZLS.YPDH, YPZLS.MJBH, YPZLS.Parent, YP' +
        'ZLS.DType, YPZLS.CLBH,YPZLS.CLZMLB   ) YPZLS'
      '      left join YPZL on YPZL.YPDH=YPZLS.YPDH'
      
        '      Left join KFXXZL on YPZL.XieXing=KFXXZL.XieXing and YPZL.S' +
        'heHao=KFXXZL.SheHao '
      
        '      Left join CLZL on CLZL.CLDH=YPZLS.CLBH ) YPZL where CLSL>0' +
        '  '
      ') OrdCL'
      'left join ('
      
        '          select SCBH,CLBH,MJBH,DType,Sum(Qty) as Qty,Sum(TempQt' +
        'y) as TempQty,Max(CNO_NK) as CNO_NK,Max(CNO_TC) as CNO_TC,Max(CN' +
        'O_HD) as CNO_HD,Max(CNO_KD) as CNO_KD,Sum(RKQty) as RKQty,'
      
        '                  Sum(NK) as NK,Sum(TC) as TC,Sum(HD) as HD,Sum(' +
        'KD) as KD,Sum(XT) as XT,Sum(GC) as GC,Sum(ZZ) as ZZ from ('
      '                  '
      
        '          select  KCLLS.LLNO,KCLLS.SCBH, KCLLS.CLBH,case when le' +
        'n(KCLLS.DFL)<10 then KCLLS.CLBH else KCLLS.DFL end as MJBH,Case ' +
        'when len(KCLLS.DFL)<10 then '#39'Assembly'#39' else '#39'Gia cong'#39'  end as D' +
        'Type, sum(KCLLS.Qty) as Qty, sum(KCLLS.TempQty) as TempQty,'
      #9#9#9#9#9'    Sum(KCLLS.Qty) as RKQty,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 end ) as ' +
        'NK,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 end ) as ' +
        'TC,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 end ) as ' +
        'HD,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 end ) as ' +
        'KD,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 end ) as ' +
        'GC,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 end ) as ' +
        'XT,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else 0 end ) a' +
        's ZZ,'
      
        '             Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO end) a' +
        's CNO_NK,'
      
        '             Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO end) a' +
        's CNO_TC,'
      
        '             Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO end) a' +
        's CNO_HD,'
      
        '             Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO end) a' +
        's CNO_KD'
      #9#9'       from KCLLS'
      '          left join KCLL on KCLL.LLNO=KCLLS.LLNO'
      #9#9'       left join DDZL on DDZL.DDBH=KCLLS.SCBH'
      #9#9'       left join CLZL on CLZL.CLDH=KCLLS.CLBH'#9#9'   '
      #9#9'       where  KCLLS.CLBH like '#39'W126000003%'#39
      #9#9#9#9'    and KCLLS.SCBH = '#39'Y2203-0555'#39' '
      '           and KCLL.GSBH='#39'CDC'#39' and KCLL.CFMID<>'#39'NO'#39' '
      
        #9#9'       group by KCLLS.LLNO,KCLLS.SCBH,case when len(KCLLS.DFL)' +
        '<10 then KCLLS.CLBH else KCLLS.DFL end,Case when len(KCLLS.DFL)<' +
        '10 then '#39'Assembly'#39' else '#39'Gia cong'#39'  end , KCLLS.CLBH'
      '           ) KCLLS Group by SCBH,CLBH,MJBH,DType'
      
        '          ) KCLLS on KCLLS.SCBH=OrdCL.ZLBH and KCLLS.CLBH=OrdCL.' +
        'CLBH and KCLLS.DType=OrdCL.DType and KCLLS.MJBH=OrdCL.MJBH '
      'where 1=1 '
      'union all '
      
        'select ZLZLS3.*,KCLLS.TempQty,KCLLS.CNO_NK,KCLLS.CNO_TC,KCLLS.CN' +
        'O_HD,KCLLS.CNO_KD,KCLLS.RKQty,IsNull(KCLLS.NK,0) as NK,IsNull(KC' +
        'LLS.TC,0) as TC,IsNull(KCLLS.HD,0) as HD,IsNull(KCLLS.KD,0) as K' +
        'D,IsNull(KCLLS.XT,0) as XT,IsNull(KCLLS.GC,0) as GC,'
      
        '       KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.TC,0)-IsNull(KC' +
        'LLS.HD,0)-IsNull(KCLLS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLLS.GC,' +
        '0) as ZZ,KCLLS.Qty'
      ' from ('
      
        'select ZLZLS3.ZLBH1 as ZLBH1,right(ZLZLS3.cldhz,10) as MJBH,righ' +
        't(ZLZLS3.cldhz,10) as Parent,'#39'Assembly'#39' as DType,right(ZLZLS3.cl' +
        'dhz,10) as cldhz,convert(float,round(sum(ZLZLS3.TCLYL),2)) as TC' +
        'LYL,'
      
        '      CLZL.ywpm,CLZL.DWBH,KFXXZL.Article,KFXXZL.XieMing,IsNull(E' +
        'RP_DDZL.Quantity,Max(DDZL.Pairs)) as Quantity,max(convert(varcha' +
        'r,cast(ZLZLS3.USERDATE as smalldatetime),111)) as CalDate,DDZL.C' +
        'QDH'
      'FROM HUONG_DD.dbo.ZLZLS3  ZLZLS3'
      
        'LEFT JOIN HUONG_DD.dbo.DDZL DDZL ON ZLZLS3.DDBH = DDZL.DDBH AND ' +
        'DDZL.CQDH = ZLZLS3.CQDH LEFT JOIN HUONG_DD.dbo.CLZL CLZL ON ZLZL' +
        'S3.cldhz = CLZL.cldh '
      
        'left join CLZL ERP_CLZL on ERP_CLZL.CLDH=Substring(ZLZLS3.cldhz,' +
        '2,10)'
      'Left join YPZL ERP_DDZL on ERP_DDZL.YPDH=DDZL.ZLBH1 '
      
        'left join KFXXZL on ERP_DDZL.XieXing=KFXXZL.XieXing and ERP_DDZL' +
        '.Shehao=KFXXZL.shehao '
      
        'where ZLZLS3.TCLYL>0 and ZLZLS3.ZLBH1='#39'Y2203-0555'#39' and ZLZLS3.CQ' +
        'DH='#39'VR1'#39
      '      and ZLZLS3.CLDHZ like '#39'AW126000003%'#39' '
      
        'GROUP BY  ZLZLS3.cldhz,ZLZLS3.ZLBH1,CLZL.zwpm,CLZL.ywpm,DDZL.CQD' +
        'H,CLZL.DWBH,KFXXZL.Article, KFXXZL.XieMing,ERP_DDZL.Quantity ) Z' +
        'LZLS3'
      'left join ('
      
        '           select KCLLS.SCBH,KCLLS.CLBH,round(sum(case when KCLL' +
        '.CFMID<>'#39'NO'#39' then KCLLS.Qty else 0 end),2) as Qty,round(sum(KCLL' +
        'S.TempQty),2) as TempQty,'
      
        '                  round(sum(case when KCLL.CFMID<>'#39'NO'#39' then KCLL' +
        'S.Qty else 0 end),2) as RKQty,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 ' +
        'end ) as NK,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 ' +
        'end ) as TC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 end ' +
        ') as HD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 end ' +
        ') as KD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 end ' +
        ') as GC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 end ' +
        ') as XT,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else 0 en' +
        'd ) as ZZ,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO e' +
        'nd) as CNO_NK,'
      
        '                  Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO e' +
        'nd) as CNO_TC,'
      
        '                  Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO e' +
        'nd) as CNO_HD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO e' +
        'nd) as CNO_KD'
      
        '           from KCLLS left join KCLL on KCLL.LLNO=KCLLS.LLNO    ' +
        '   '
      '           where 1=1 '
      '                 and KCLL.GSBH='#39'VR1'#39' '
      '                 and KCLLS.SCBH ='#39'Y2203-0555'#39' '
      
        '           group by KCLLS.SCBH,KCLLS.CLBH ) KCLLS on KCLLS.SCBH=' +
        'ZLZLS3.ZLBH1 and KCLLS.CLBH=ZLZLS3.CLDHZ '
      'union all '
      
        'select ZLZLS3.*,KCLLS.TempQty,KCLLS.CNO_NK,KCLLS.CNO_TC,KCLLS.CN' +
        'O_HD,KCLLS.CNO_KD,KCLLS.RKQty,IsNull(KCLLS.NK,0) as NK,IsNull(KC' +
        'LLS.TC,0) as TC,IsNull(KCLLS.HD,0) as HD,IsNull(KCLLS.KD,0) as K' +
        'D,IsNull(KCLLS.XT,0) as XT,IsNull(KCLLS.GC,0) as GC,'
      
        '       KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.TC,0)-IsNull(KC' +
        'LLS.HD,0)-IsNull(KCLLS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLLS.GC,' +
        '0) as ZZ,KCLLS.Qty'
      ' from ('
      
        'select ZLZLS3.ZLBH1 as ZLBH1,right(ZLZLS3.cldhz,10) as MJBH,righ' +
        't(ZLZLS3.cldhz,10) as Parent,'#39'Assembly'#39' as DType,right(ZLZLS3.cl' +
        'dhz,10) as cldhz,convert(float,round(sum(ZLZLS3.TCLYL),2)) as TC' +
        'LYL,'
      
        '      CLZL.ywpm,CLZL.DWBH,KFXXZL.Article,KFXXZL.XieMing,IsNull(E' +
        'RP_DDZL.Quantity,Max(DDZL.Pairs)) as Quantity,max(convert(varcha' +
        'r,cast(ZLZLS3.USERDATE as smalldatetime),111)) as CalDate,DDZL.C' +
        'QDH'
      'FROM HUONG_DD.dbo.ZLZLS3  ZLZLS3'
      
        'LEFT JOIN HUONG_DD.dbo.DDZL DDZL ON ZLZLS3.DDBH = DDZL.DDBH AND ' +
        'DDZL.CQDH = ZLZLS3.CQDH LEFT JOIN HUONG_DD.dbo.CLZL CLZL ON ZLZL' +
        'S3.cldhz = CLZL.cldh '
      
        'left join CLZL ERP_CLZL on ERP_CLZL.CLDH=Substring(ZLZLS3.cldhz,' +
        '2,10)'
      'Left join YPZL ERP_DDZL on ERP_DDZL.YPDH=DDZL.ZLBH1 '
      
        'left join KFXXZL on ERP_DDZL.XieXing=KFXXZL.XieXing and ERP_DDZL' +
        '.Shehao=KFXXZL.shehao '
      
        'where ZLZLS3.TCLYL>0 and ZLZLS3.ZLBH1='#39'Y2203-0555'#39' and ZLZLS3.CQ' +
        'DH='#39'VR2'#39
      '      and ZLZLS3.CLDHZ like '#39'AW126000003%'#39' '
      
        'GROUP BY  ZLZLS3.cldhz,ZLZLS3.ZLBH1,CLZL.zwpm,CLZL.ywpm,DDZL.CQD' +
        'H,CLZL.DWBH,KFXXZL.Article, KFXXZL.XieMing,ERP_DDZL.Quantity ) Z' +
        'LZLS3'
      'left join ('
      
        '           select KCLLS.SCBH,KCLLS.CLBH,round(sum(case when KCLL' +
        '.CFMID<>'#39'NO'#39' then KCLLS.Qty else 0 end),2) as Qty,round(sum(KCLL' +
        'S.TempQty),2) as TempQty,'
      
        '                  round(sum(case when KCLL.CFMID<>'#39'NO'#39' then KCLL' +
        'S.Qty else 0 end),2) as RKQty,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 ' +
        'end ) as NK,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 ' +
        'end ) as TC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 end ' +
        ') as HD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 end ' +
        ') as KD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 end ' +
        ') as GC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 end ' +
        ') as XT,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else 0 en' +
        'd ) as ZZ,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO e' +
        'nd) as CNO_NK,'
      
        '                  Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO e' +
        'nd) as CNO_TC,'
      
        '                  Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO e' +
        'nd) as CNO_HD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO e' +
        'nd) as CNO_KD'
      
        '           from KCLLS left join KCLL on KCLL.LLNO=KCLLS.LLNO    ' +
        '   '
      '           where 1=1 '
      '                 and KCLL.GSBH='#39'VR2'#39' '
      '                 and KCLLS.SCBH ='#39'Y2203-0555'#39' '
      
        '           group by KCLLS.SCBH,KCLLS.CLBH ) KCLLS on KCLLS.SCBH=' +
        'ZLZLS3.ZLBH1 and KCLLS.CLBH=ZLZLS3.CLDHZ '
      'union all '
      
        'select ZLZLS3.*,KCLLS.TempQty,KCLLS.CNO_NK,KCLLS.CNO_TC,KCLLS.CN' +
        'O_HD,KCLLS.CNO_KD,KCLLS.RKQty,IsNull(KCLLS.NK,0) as NK,IsNull(KC' +
        'LLS.TC,0) as TC,IsNull(KCLLS.HD,0) as HD,IsNull(KCLLS.KD,0) as K' +
        'D,IsNull(KCLLS.XT,0) as XT,IsNull(KCLLS.GC,0) as GC,'
      
        '       KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.TC,0)-IsNull(KC' +
        'LLS.HD,0)-IsNull(KCLLS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLLS.GC,' +
        '0) as ZZ,KCLLS.Qty'
      ' from ('
      
        'select ZLZLS3.ZLBH1 as ZLBH1,right(ZLZLS3.cldhz,10) as MJBH,righ' +
        't(ZLZLS3.cldhz,10) as Parent,'#39'Assembly'#39' as DType,right(ZLZLS3.cl' +
        'dhz,10) as cldhz,convert(float,round(sum(ZLZLS3.TCLYL),2)) as TC' +
        'LYL,'
      
        '      CLZL.ywpm,CLZL.DWBH,KFXXZL.Article,KFXXZL.XieMing,IsNull(E' +
        'RP_DDZL.Quantity,Max(DDZL.Pairs)) as Quantity,max(convert(varcha' +
        'r,cast(ZLZLS3.USERDATE as smalldatetime),111)) as CalDate,DDZL.C' +
        'QDH'
      'FROM HUONG_DD.dbo.ZLZLS3  ZLZLS3'
      
        'LEFT JOIN HUONG_DD.dbo.DDZL DDZL ON ZLZLS3.DDBH = DDZL.DDBH AND ' +
        'DDZL.CQDH = ZLZLS3.CQDH LEFT JOIN HUONG_DD.dbo.CLZL CLZL ON ZLZL' +
        'S3.cldhz = CLZL.cldh '
      
        'left join CLZL ERP_CLZL on ERP_CLZL.CLDH=Substring(ZLZLS3.cldhz,' +
        '2,10)'
      'Left join YPZL ERP_DDZL on ERP_DDZL.YPDH=DDZL.ZLBH1 '
      
        'left join KFXXZL on ERP_DDZL.XieXing=KFXXZL.XieXing and ERP_DDZL' +
        '.Shehao=KFXXZL.shehao '
      
        'where ZLZLS3.TCLYL>0 and ZLZLS3.ZLBH1='#39'Y2203-0555'#39' and ZLZLS3.CQ' +
        'DH='#39'VR3'#39
      '      and ZLZLS3.CLDHZ like '#39'AW126000003%'#39' '
      
        'GROUP BY  ZLZLS3.cldhz,ZLZLS3.ZLBH1,CLZL.zwpm,CLZL.ywpm,DDZL.CQD' +
        'H,CLZL.DWBH,KFXXZL.Article, KFXXZL.XieMing,ERP_DDZL.Quantity ) Z' +
        'LZLS3'
      'left join ('
      
        '           select KCLLS.SCBH,KCLLS.CLBH,round(sum(case when KCLL' +
        '.CFMID<>'#39'NO'#39' then KCLLS.Qty else 0 end),2) as Qty,round(sum(KCLL' +
        'S.TempQty),2) as TempQty,'
      
        '                  round(sum(case when KCLL.CFMID<>'#39'NO'#39' then KCLL' +
        'S.Qty else 0 end),2) as RKQty,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 ' +
        'end ) as NK,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 ' +
        'end ) as TC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 end ' +
        ') as HD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 end ' +
        ') as KD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 end ' +
        ') as GC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 end ' +
        ') as XT,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else 0 en' +
        'd ) as ZZ,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO e' +
        'nd) as CNO_NK,'
      
        '                  Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO e' +
        'nd) as CNO_TC,'
      
        '                  Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO e' +
        'nd) as CNO_HD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO e' +
        'nd) as CNO_KD'
      
        '           from KCLLS left join KCLL on KCLL.LLNO=KCLLS.LLNO    ' +
        '   '
      '           where 1=1 '
      '                 and KCLL.GSBH='#39'VR3'#39' '
      '                 and KCLLS.SCBH ='#39'Y2203-0555'#39' '
      
        '           group by KCLLS.SCBH,KCLLS.CLBH ) KCLLS on KCLLS.SCBH=' +
        'ZLZLS3.ZLBH1 and KCLLS.CLBH=ZLZLS3.CLDHZ '
      'union all'
      
        'select KCLLS.SCBH as ZLBH1,case when len(KCLLS.DFL)<10 then KCLL' +
        'S.CLBH else KCLLS.DFL end as MJBH,KCLLS.CLBH as Parent,Case when' +
        ' len(KCLLS.DFL)<10 then '#39'Assembly'#39' else '#39'Gia cong'#39'  end as DType' +
        ','
      
        '       KCLLS.CLBH as cldhz,0 as TCLYL,CLZL.YWPM,CLZL.DWBH,DDZL.A' +
        'rticle,XXZL.XieMing,DDZL.Pairs,null as CalDate,KCLL.GSBH as CQDH' +
        ',KCLLS.TempQty'
      
        '       ,KCRKCX.CNO_NK,KCRKCX.CNO_TC,KCRKCX.CNO_HD,KCRKCX.CNO_KD,' +
        'KCRKCX.RKQty,IsNull(KCRKCX.NK,0) as NK,IsNull(KCRKCX.TC,0) as TC' +
        ',IsNull(KCRKCX.HD,0) as HD,IsNull(KCRKCX.KD,0) as KD,IsNull(KCRK' +
        'CX.XT,0) as XT,IsNull(KCRKCX.GC,0) as GC'
      
        '       ,KCLLS.Qty-IsNull(KCRKCX.NK,0)-IsNull(KCRKCX.TC,0)-IsNull' +
        '(KCRKCX.HD,0)-IsNull(KCRKCX.KD,0)-IsNull(KCRKCX.XT,0)-IsNull(KCR' +
        'KCX.GC,0) as ZZ'
      '       ,KCLLS.Qty'
      'from  KCLLS'
      'left join DDZL on DDZL.DDBH=KCLLS.SCBH'
      
        'left join XXZL on DDZL.XieXing=xxzl.XieXing and DDZL.Shehao=xxzl' +
        '.shehao'
      'left join CLZL on CLZL.CLDH=KCLLS.CLBH'
      'left join KCLL on KCLL.LLNO=KCLLS.LLNO  '
      'left join ( '
      
        '          select KCLLS.LLNO,KCLLS.CLBH,KCLLS.SCBH,KCLLS.DFL,Sum(' +
        'KCLLS.Qty) as RKQty,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 ' +
        'end ) as NK, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 ' +
        'end ) as TC, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 ' +
        'end ) as HD, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 ' +
        'end ) as KD, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 ' +
        'end ) as XT, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 ' +
        'end ) as GC, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else ' +
        '0 end ) as ZZ, '
      
        '                  Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO e' +
        'nd) as CNO_NK, '
      
        '                  Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO e' +
        'nd) as CNO_TC, '
      
        '                  Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO e' +
        'nd) as CNO_HD, '
      
        '                  Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO e' +
        'nd) as CNO_KD '
      '           from KCLLS '
      '           where KCLLS.SCBH = '#39'Y2203-0555'#39' '
      '                 and KCLLS.CLBH like '#39'W126000003%'#39' '
      '           Group by KCLLS.LLNO,KCLLS.CLBH,KCLLS.SCBH,KCLLS.DFL '
      
        '           ) KCRKCX on KCRKCX.LLNO=KCLLS.LLNO and KCRKCX.CLBH=KC' +
        'LLS.CLBH and KCRKCX.DFL=KCLLS.DFL and KCRKCX.SCBH=KCLLS.SCBH    ' +
        '       '
      'WHERE KCLL.GSBH ='#39'CDC'#39' and KCLL.CFMID<>'#39'NO'#39' '
      '      and NOT EXISTS ( select * from (select CLBH from ('
      '      SELECT ypzls.CLBH '
      '      FROM ypzls ypzls '
      '      WHERE YPDH = '#39'Y2203-0555'#39' '
      '      union all '
      '      SELECT clzhzl.CLDH1 as CLBH'
      '      FROM ypzls ypzls '
      '      Left join clzhzl ON  ypzls.CLBH = CLZHZL.cldh '
      '      WHERE YPDH = '#39'Y2203-0555'#39'  and CLZHZL.SYL>0  '
      '      union all'
      '      Select clzhzl.CLDH1 as CLBH '
      '       from ('
      '      SELECT clzhzl.CLDH1 as CLBH'
      '      FROM ypzls ypzls '
      '      inner join clzhzl ON  ypzls.CLBH = CLZHZL.cldh '
      '      left JOIN clzl clzl ON CLZHZL.cldh1 = clzl.cldh'
      
        '      WHERE YPDH = '#39'Y2203-0555'#39'  and CLZHZL.SYL>0   and clzl.clz' +
        'mlb='#39'Y'#39'  '
      '      ) clzhzl2'
      
        '      inner join clzhzl ON  clzhzl2.CLBH = CLZHZL.cldh  ) YPZLS ' +
        'Group by CLBH ) YPZLS where KCLLS.CLBH=YPZLS.CLBH) '
      
        '   and KCLLS.SCBH like '#39'Y2203-0555'#39' and KCLLS.CLBH like '#39'W126000' +
        '003%'#39' and KCLLS.Qty>0'
      'union all'
      
        'select KCLLS.SCBH as ZLBH1,KCLLS.CLBH as MJBH,KCLLS.CLBH as Pare' +
        'nt,'#39'Assembly'#39' as DType,KCLLS.CLBH as cldhz,0 as TCLYL,CLZL.YWPM,' +
        'CLZL.DWBH,DDZL.Article,XXZL.XieMing,DDZL.Pairs,null as CalDate,K' +
        'CLL.GSBH as CQDH,KCLLS.TempQty'
      
        '       ,KCRKCX.CNO_NK,KCRKCX.CNO_TC,KCRKCX.CNO_HD,KCRKCX.CNO_KD,' +
        'KCRKCX.RKQty,IsNull(KCRKCX.NK,0) as NK,IsNull(KCRKCX.TC,0) as TC' +
        ',IsNull(KCRKCX.HD,0) as HD,IsNull(KCRKCX.KD,0) as KD,IsNull(KCRK' +
        'CX.XT,0) as XT,IsNull(KCRKCX.GC,0) as GC'
      
        '       ,KCLLS.Qty-IsNull(KCRKCX.NK,0)-IsNull(KCRKCX.TC,0)-IsNull' +
        '(KCRKCX.HD,0)-IsNull(KCRKCX.KD,0)-IsNull(KCRKCX.XT,0)-IsNull(KCR' +
        'KCX.GC,0) as ZZ'
      '       ,KCLLS.Qty'
      'from  KCLLS'
      'left join DDZL on DDZL.DDBH=KCLLS.SCBH'
      
        'left join XXZL on DDZL.XieXing=xxzl.XieXing and DDZL.Shehao=xxzl' +
        '.shehao'
      'left join CLZL on CLZL.CLDH=KCLLS.CLBH'
      'left join KCLL on KCLL.LLNO=KCLLS.LLNO  '
      'left join ( '
      
        '          select KCLLS.LLNO,KCLLS.CLBH,KCLLS.SCBH,KCLLS.DFL,Sum(' +
        'KCLLS.Qty) as RKQty,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 ' +
        'end ) as NK, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 ' +
        'end ) as TC, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 ' +
        'end ) as HD, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 ' +
        'end ) as KD, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 ' +
        'end ) as XT, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 ' +
        'end ) as GC,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else ' +
        '0 end ) as ZZ,  '
      
        '                  Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO e' +
        'nd) as CNO_NK, '
      
        '                  Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO e' +
        'nd) as CNO_TC, '
      
        '                  Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO e' +
        'nd) as CNO_HD, '
      
        '                  Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO e' +
        'nd) as CNO_KD '
      '           from KCLLS '
      '           where KCLLS.SCBH = '#39'Y2203-0555'#39' '
      '                 and KCLLS.CLBH like '#39'W126000003%'#39' '
      '           Group by KCLLS.LLNO,KCLLS.CLBH,KCLLS.SCBH,KCLLS.DFL '
      
        '           ) KCRKCX on KCRKCX.LLNO=KCLLS.LLNO and KCRKCX.CLBH=KC' +
        'LLS.CLBH and KCRKCX.DFL=KCLLS.DFL and KCRKCX.SCBH=KCLLS.SCBH    ' +
        '       '
      
        'WHERE KCLL.GSBH like '#39'VR%'#39' and KCLL.CFMID<>'#39'NO'#39' and NOT EXISTS(S' +
        'ELECT *  FROM HUONG_DD.dbo.ZLZLS3  ZLZLS3  WHERE '#39'A'#39'+KCLLS.CLBH=' +
        'ZLZLS3.CLDHZ AND KCLLS.SCBH=ZLZLS3.ZLBH1)'
      
        '   and KCLLS.SCBH like '#39'Y2203-0555'#39' and KCLLS.CLBH like '#39'W126000' +
        '003%'#39' and KCLLS.Qty>0'
      '  ) ZLZLS2    '
      'Left join CLHG on CLHG.CLBH=ZLZLS2.CLBH  '
      'Left join CLHD on CLHD.CLBH=ZLZLS2.CLBH  '
      'Left join CLKD on CLKD.CLBH=ZLZLS2.CLBH  '
      'Left join CLTC on CLTC.CLBH=ZLZLS2.CLBH  '
      'Left join ('
      
        'Select KCRKS.GSBH,KCRKS.CGBH as ZLBH,Case when len(KCRKS.RKSB)<1' +
        '0 then KCRKS.CLBH else KCRKS.RKSB End as MJBH,Case when len(KCRK' +
        'S.RKSB)<10 then '#39'Assembly'#39' else '#39'Gia cong'#39' End as DType ,KCRKS.C' +
        'LBH, '
      '       Sum(KCRKS.Qty) as Qty, '
      
        '       Sum(Case when KCRK.HGLB='#39'NK'#39' then Qty else 0 end ) as NK,' +
        ' '
      
        '       Sum(Case when KCRK.HGLB='#39'TC'#39' then Qty else 0 end ) as TC,' +
        ' '
      
        '       Sum(Case when KCRK.HGLB='#39'HD'#39' then Qty else 0 end ) as HD,' +
        ' '
      
        '       Sum(Case when KCRK.HGLB='#39'KD'#39' then Qty else 0 end ) as KD,' +
        ' '
      
        '       Sum(Case when KCRK.HGLB='#39'XT'#39' then Qty else 0 end ) as XT,' +
        ' '
      
        '       Sum(Case when KCRK.HGLB='#39'GC'#39' then Qty else 0 end ) as GC,' +
        ' '
      
        '       Sum(Case when KCRK.HGLB='#39'ZZZZ'#39' then Qty else 0 end ) as Z' +
        'Z  '
      'from KCRK '
      'left join KCRKS on KCRK.RKNO=KCRKS.RKNO '
      'where KCRK.SFL='#39'THU HOI'#39'  and KCRKS.CGBH='#39'Y2203-0555'#39' '
      'Group by KCRKS.GSBH,KCRKS.CGBH,KCRKS.RKSB,KCRKS.CLBH '
      
        ') KCRKTH on  KCRKTH.ZLBH=ZLZLS2.ZLBH and KCRKTH.CLBH=ZLZLS2.CLBH' +
        ' and KCRKTH.DType=ZLZLS2.DType and KCRKTH.MJBH=ZLZLS2.MJBH  and ' +
        'KCRKTH.GSBH=ZLZLS2.GSBH'
      ') ZLZLS2 where 1=1  '
      
        'and IsNull(HG_NO,'#39#39')<>'#39#39' or IsNull(TC_NO,'#39#39')<>'#39#39' or IsNull(HD_NO' +
        ','#39#39')<>'#39#39' or IsNull(KD_NO,'#39#39')<>'#39#39' '
      
        'Group by ZLZLS2.HG_NO,ZLZLS2.Rate_HG,ZLZLS2.TC_NO,ZLZLS2.Rate_TC' +
        ',ZLZLS2.HD_NO,ZLZLS2.Rate_HD,ZLZLS2.KD_NO'
      'Order by ZLZLS2.HG_NO desc,ZLZLS2.TC_NO desc,ZLZLS2.HD_NO desc'
      '')
    Left = 67
    Top = 213
    object HGQueryZLBH: TStringField
      FieldName = 'ZLBH'
      Size = 18
    end
    object HGQueryHG_NO: TStringField
      FieldName = 'HG_NO'
      FixedChar = True
      Size = 15
    end
    object HGQueryTC_NO: TStringField
      FieldName = 'TC_NO'
      FixedChar = True
      Size = 15
    end
    object HGQueryHD_NO: TStringField
      FieldName = 'HD_NO'
      FixedChar = True
      Size = 15
    end
    object HGQueryKD_NO: TStringField
      FieldName = 'KD_NO'
      FixedChar = True
      Size = 15
    end
    object HGQueryUsage: TFloatField
      FieldName = 'Usage'
    end
    object FloatField4: TFloatField
      FieldName = 'CLSL'
      DisplayFormat = '#0.000000'
    end
    object CurrencyField9: TCurrencyField
      FieldName = 'Qty'
      DisplayFormat = '#0.000000'
    end
    object CurrencyField10: TCurrencyField
      FieldName = 'NK'
      DisplayFormat = '#0.000000'
    end
    object HGQueryTC: TFloatField
      FieldName = 'TC'
      DisplayFormat = '#0.000000'
    end
    object CurrencyField11: TCurrencyField
      FieldName = 'HD'
      DisplayFormat = '#0.000000'
    end
    object CurrencyField12: TCurrencyField
      FieldName = 'KD'
      DisplayFormat = '#0.000000'
    end
    object CurrencyField13: TCurrencyField
      FieldName = 'XT'
      DisplayFormat = '#0.000000'
    end
    object CurrencyField14: TCurrencyField
      FieldName = 'GC'
      DisplayFormat = '#0.000000'
    end
    object CurrencyField15: TCurrencyField
      FieldName = 'ZZ'
      DisplayFormat = '#0.000000'
    end
    object HGQueryHG_HGPM: TStringField
      FieldName = 'HG_HGPM'
      FixedChar = True
      Size = 200
    end
    object HGQueryHG_Unit: TStringField
      FieldName = 'HG_Unit'
      FixedChar = True
      Size = 40
    end
    object HGQueryTC_HGPM: TStringField
      FieldName = 'TC_HGPM'
      FixedChar = True
      Size = 200
    end
    object HGQueryTC_Unit: TStringField
      FieldName = 'TC_Unit'
      FixedChar = True
      Size = 40
    end
    object HGQueryHD_HGPM: TStringField
      FieldName = 'HD_HGPM'
      FixedChar = True
      Size = 200
    end
    object HGQueryHD_Unit: TStringField
      FieldName = 'HD_Unit'
      FixedChar = True
      Size = 40
    end
  end
  object HGDS: TDataSource
    DataSet = HGQuery
    Left = 69
    Top = 247
  end
  object PopupMenu3: TPopupMenu
    Left = 97
    Top = 181
    object MenuItem1: TMenuItem
      Caption = 'Excel'
      OnClick = MenuItem1Click
    end
    object MenuItem3: TMenuItem
      Caption = 'Detail'
      OnClick = MenuItem3Click
    end
    object N1: TMenuItem
      Caption = '-'
    end
    object MAHG1: TMenuItem
      Caption = 'MA HG'
      OnClick = MAHG1Click
    end
  end
  object RYQuery: TQuery
    OnCalcFields = RYQueryCalcFields
    DatabaseName = 'DB'
    SQL.Strings = (
      
        'Select ZLZLS2.ZLBH,ZLZLS2.MJBH,ZLZLS2.Parent,ZLZLS2.DType,ZLZLS2' +
        '.CLBH,ZLZLS2.CLSL,ZLZLS2.YWPM,ZLZLS2.dwbh,ZLZLS2.ARTICLE,ZLZLS2.' +
        'XieMing,ZLZLS2.Quantity,ZLZLS2.CalDate,ZLZLS2.GSBH,ZLZLS2.TempQt' +
        'y,ZLZLS2.RKQty '
      
        '       ,ZLZLS2.NK,ZLZLS2.TC,ZLZLS2.HD,ZLZLS2.KD,ZLZLS2.XT,ZLZLS2' +
        '.GC,ZLZLS2.NQ,ZLZLS2.ZZ,ZLZLS2.Qty '
      
        '       ,CLHG.RateC as Rate_HG,case when (ZLZLS2.NK>0)  then IsNu' +
        'll(CNO_NK,CLHG.HGBH) else null end as HG_NO '
      
        '       ,CLTC.RateC as Rate_TC,case when (ZLZLS2.TC>0)  then IsNu' +
        'll(CNO_TC,CLTC.HGBH) else null end as TC_NO '
      
        '       ,CLHD.RateC as Rate_HD,case when (ZLZLS2.HD>0)  then IsNu' +
        'll(CNO_HD,CLHD.HGBH) else null end as HD_NO '
      
        '       ,CLKD.RateC as Rate_KD,case when (ZLZLS2.KD>0)  then IsNu' +
        'll(CNO_KD,CLKD.HGBH) else null end as KD_NO'
      
        '       ,CLNQ.RateC as Rate_NQ,case when (ZLZLS2.NQ>0)  then IsNu' +
        'll(CNO_NQ,CLNQ.HGBH) else null end as NQ_NO '
      '       ,KCRKTH.Qty as THQty,KCLLMeMo.LLMemo from ('
      
        'select OrdCL.*,Round(KCLLS.TempQty,2) as TempQty ,case when KCLL' +
        'S.CNO_NK='#39#39' then null else CNO_NK end CNO_NK,case when KCLLS.CNO' +
        '_TC='#39#39' then null else CNO_TC end CNO_TC'
      
        ',case when KCLLS.CNO_HD='#39#39' then null else CNO_HD end CNO_HD,case' +
        ' when KCLLS.CNO_KD='#39#39' then null else CNO_KD end CNO_KD,case when' +
        ' KCLLS.CNO_NQ='#39#39' then null else CNO_NQ end CNO_NQ,KCLLS.RKQty,'
      
        '       IsNull(KCLLS.NK,0) as NK,IsNull(KCLLS.TC,0) as TC,IsNull(' +
        'KCLLS.HD,0) as HD,IsNull(KCLLS.KD,0) as KD,IsNull(KCLLS.XT,0) as' +
        ' XT,IsNull(KCLLS.GC,0) as GC,IsNull(KCLLS.NQ,0) as NQ,'
      
        '       IsNull(Round(KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.TC' +
        ',0)-IsNull(KCLLS.HD,0)-IsNull(KCLLS.KD,0)-IsNull(KCLLS.XT,0)-IsN' +
        'ull(KCLLS.GC,0)-IsNull(KCLLS.NQ,0),2),0)  as ZZ,KCLLS.Qty '
      
        'from (select * from (select YPZLS.YPDH as ZLBH,YPZLS.MJBH,YPZLS.' +
        'Parent,YPZLS.DType,YPZLS.CLBH, YPZLS.CLSL, '
      
        '      CLZL.YWPM,CLZL.DWBH,KFXXZL.Article,KFXXZL.XieMing,YPZL.Qua' +
        'ntity ,YPZL.USERDATE as CalDate,YPZL.GSDH as GSBH  from ( '
      
        '      Select YPZLS.YPDH, YPZLS.MJBH, YPZLS.Parent, YPZLS.DType, ' +
        'YPZLS.CLBH,YPZLS.CLZMLB,Sum(YPZLS.CLSL) as CLSL from ( '
      
        '      SELECT ypzls.YPDH ,ypzls.xh,ypzls.CLBH as MJBH,ypzls.CLBH ' +
        'as Parent ,'#39'Assembly'#39' as DType,ypzls.CLBH,CEILING(ypzls.CLSL*YPZ' +
        'L.Quantity*100)/100 as CLSL,clzl.CLZMLB '
      '      FROM ypzls ypzls '
      '      LEFT JOIN YPZL on YPZL.YPDH=YPZLS.YPDH '
      '      LEFT JOIN clzl clzl ON ypzls.CLBH = clzl.cldh '
      
        '      left join YPZL_NoNeedPart on YPZL_NoNeedPart.BWBH=ypzls.BW' +
        'BH'
      '      WHERE YPZLS.YPDH = '#39'Y2203-0555'#39' '
      '            and CLZL.CLDH like '#39'W126000003%'#39' '
      '            and YPZL_NoNeedPart.bwbh is null'
      '      union all '
      
        '      SELECT ypzls.YPDH ,ypzls.xh  ,clzhzl.cldh as MJBH,ypzls.cl' +
        'bh as Parent,'#39'Gia cong'#39' as DType,clzhzl.CLDH1 as CLBH ,Round((CE' +
        'ILING(YPZLS.CLSL*YPZL.Quantity*100)/100)*CLZHZL.SYL,2) as CLSL,c' +
        'lzl.CLZMLB '
      '      FROM ypzls ypzls '
      '      LEFT JOIN YPZL on YPZL.YPDH=YPZLS.YPDH '
      '      Left join clzhzl ON  ypzls.CLBH = CLZHZL.cldh '
      '      LEFT JOIN clzl clzl ON CLZHZL.cldh1 = clzl.cldh '
      
        '      left join YPZL_NoNeedPart on YPZL_NoNeedPart.BWBH=ypzls.BW' +
        'BH'
      '      WHERE YPZLS.YPDH = '#39'Y2203-0555'#39'  and CLZHZL.SYL>0  '
      '            and CLZL.CLDH like '#39'W126000003%'#39' '
      '            and YPZL_NoNeedPart.bwbh is null'
      '      union all'
      
        '      Select clzhzl2.YPDH,clzhzl2.XH,clzhzl.CLDH as MJBH,clzhzl2' +
        '.Parent,clzhzl2.DType ,clzhzl.CLDH1 as CLBH,Round(clzhzl2.CLSL*c' +
        'lzhzl.syl,2) as CLSL,clzl.clzmlb '
      '       from ('
      
        '      SELECT ypzls.YPDH ,ypzls.xh  ,YPZLS.CLBH as Parent,'#39'Gia co' +
        'ng'#39' as DType,clzhzl.CLDH1 as CLBH,Round((CEILING(YPZLS.CLSL*YPZL' +
        '.Quantity*100)/100)*CLZHZL.SYL,2) as CLSL '
      '      FROM ypzls ypzls '
      '      LEFT JOIN YPZL on YPZL.YPDH=YPZLS.YPDH '
      '      inner join clzhzl ON  ypzls.CLBH = CLZHZL.cldh '
      '      left JOIN clzl clzl ON CLZHZL.cldh1 = clzl.cldh '
      
        '      left join YPZL_NoNeedPart on YPZL_NoNeedPart.BWBH=ypzls.BW' +
        'BH'
      
        '      WHERE YPZLS.YPDH = '#39'Y2203-0555'#39'  and CLZHZL.SYL>0   and cl' +
        'zl.clzmlb='#39'Y'#39' and YPZL_NoNeedPart.bwbh is null'
      '      ) clzhzl2'
      '      inner join clzhzl ON  clzhzl2.CLBH = CLZHZL.cldh '
      '      left JOIN clzl clzl ON CLZHZL.cldh1 = clzl.cldh '
      '      where  CLZL.CLDH like '#39'W126000003%'#39' '
      
        '      )  YPZLS Group by YPZLS.YPDH, YPZLS.MJBH, YPZLS.Parent, YP' +
        'ZLS.DType, YPZLS.CLBH,YPZLS.CLZMLB   ) YPZLS'
      '      left join YPZL on YPZL.YPDH=YPZLS.YPDH'
      
        '      Left join KFXXZL on YPZL.XieXing=KFXXZL.XieXing and YPZL.S' +
        'heHao=KFXXZL.SheHao '
      
        '      Left join CLZL on CLZL.CLDH=YPZLS.CLBH ) YPZL where CLSL>0' +
        '  '
      ') OrdCL'
      'left join ('
      
        '          select SCBH,CLBH,MJBH,DType,Sum(Qty) as Qty,Sum(TempQt' +
        'y) as TempQty,Max(CNO_NK) as CNO_NK,Max(CNO_TC) as CNO_TC,Max(CN' +
        'O_HD) as CNO_HD,Max(CNO_KD) as CNO_KD,Max(CNO_NQ) as CNO_NQ,Sum(' +
        'RKQty) as RKQty,'
      
        '                  Sum(NK) as NK,Sum(TC) as TC,Sum(HD) as HD,Sum(' +
        'KD) as KD,Sum(XT) as XT,Sum(GC) as GC,Sum(NQ) as NQ,Sum(ZZ) as Z' +
        'Z from ('
      '                  '
      
        '          select  KCLLS.LLNO,KCLLS.SCBH, KCLLS.CLBH,case when le' +
        'n(KCLLS.DFL)<10 then KCLLS.CLBH else KCLLS.DFL end as MJBH,Case ' +
        'when len(KCLLS.DFL)<10 then '#39'Assembly'#39' else '#39'Gia cong'#39'  end as D' +
        'Type, sum(KCLLS.Qty) as Qty, sum(KCLLS.TempQty) as TempQty,'
      #9#9#9#9#9'    Sum(KCLLS.Qty) as RKQty,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 end ) as ' +
        'NK,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 end ) as ' +
        'TC,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 end ) as ' +
        'HD,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 end ) as ' +
        'KD,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 end ) as ' +
        'GC,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 end ) as ' +
        'XT,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'NQ'#39' then Qty else 0 end ) as ' +
        'NQ,'
      
        #9#9#9#9#9'    Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else 0 end ) a' +
        's ZZ,'
      
        '             Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO end) a' +
        's CNO_NK,'
      
        '             Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO end) a' +
        's CNO_TC,'
      
        '             Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO end) a' +
        's CNO_HD,'
      
        '             Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO end) a' +
        's CNO_KD,'
      
        '             Max(Case when KCLLS.HGLB='#39'NQ'#39' then KCLLS.CNO end) a' +
        's CNO_NQ'
      #9#9'       from KCLLS'
      '          left join KCLL on KCLL.LLNO=KCLLS.LLNO'
      #9#9'       left join DDZL on DDZL.DDBH=KCLLS.SCBH'
      #9#9'       left join CLZL on CLZL.CLDH=KCLLS.CLBH'#9#9'   '
      #9#9'       where  KCLLS.CLBH like '#39'W126000003%'#39
      #9#9#9#9'    and KCLLS.SCBH = '#39'Y2203-0555'#39' '
      '           and KCLL.GSBH='#39'CDC'#39' and KCLL.CFMID<>'#39'NO'#39' '
      
        #9#9'       group by KCLLS.LLNO,KCLLS.SCBH,case when len(KCLLS.DFL)' +
        '<10 then KCLLS.CLBH else KCLLS.DFL end,Case when len(KCLLS.DFL)<' +
        '10 then '#39'Assembly'#39' else '#39'Gia cong'#39'  end , KCLLS.CLBH'
      '           ) KCLLS Group by SCBH,CLBH,MJBH,DType'
      
        '          ) KCLLS on KCLLS.SCBH=OrdCL.ZLBH and KCLLS.CLBH=OrdCL.' +
        'CLBH and KCLLS.DType=OrdCL.DType and KCLLS.MJBH=OrdCL.MJBH '
      'where 1=1 '
      'union all '
      
        'select ZLZLS3.*,KCLLS.TempQty,KCLLS.CNO_NK,KCLLS.CNO_TC,KCLLS.CN' +
        'O_HD,KCLLS.CNO_KD,KCLLS.CNO_NQ,KCLLS.RKQty,IsNull(KCLLS.NK,0) as' +
        ' NK,IsNull(KCLLS.TC,0) as TC,IsNull(KCLLS.HD,0) as HD,IsNull(KCL' +
        'LS.KD,0) as KD,IsNull(KCLLS.XT,0) as XT,IsNull(KCLLS.GC,0) as GC' +
        ',IsNull(KCLLS.NQ,0) as NQ,'
      
        '       KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.TC,0)-IsNull(KC' +
        'LLS.HD,0)-IsNull(KCLLS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLLS.GC,' +
        '0)-IsNull(KCLLS.NQ,0) as ZZ,KCLLS.Qty'
      ' from ('
      
        'select ZLZLS3.ZLBH1 as ZLBH1,right(ZLZLS3.cldhz,10) as MJBH,righ' +
        't(ZLZLS3.cldhz,10) as Parent,'#39'Assembly'#39' as DType,right(ZLZLS3.cl' +
        'dhz,10) as cldhz,convert(float,round(sum(ZLZLS3.TCLYL),2)) as TC' +
        'LYL,'
      
        '      CLZL.ywpm,CLZL.DWBH,KFXXZL.Article,KFXXZL.XieMing,IsNull(E' +
        'RP_DDZL.Quantity,Max(DDZL.Pairs)) as Quantity,max(convert(varcha' +
        'r,cast(ZLZLS3.USERDATE as smalldatetime),111)) as CalDate,DDZL.C' +
        'QDH'
      'FROM LIY_DD.dbo.ZLZLS3  ZLZLS3'
      
        'LEFT JOIN LIY_DD.dbo.DDZL DDZL ON ZLZLS3.DDBH = DDZL.DDBH AND DD' +
        'ZL.CQDH = ZLZLS3.CQDH LEFT JOIN LIY_DD.dbo.CLZL CLZL ON ZLZLS3.c' +
        'ldhz = CLZL.cldh '
      
        'left join CLZL ERP_CLZL on ERP_CLZL.CLDH=Substring(ZLZLS3.cldhz,' +
        '2,10)'
      'Left join YPZL ERP_DDZL on ERP_DDZL.YPDH=DDZL.ZLBH1 '
      
        'left join KFXXZL on ERP_DDZL.XieXing=KFXXZL.XieXing and ERP_DDZL' +
        '.Shehao=KFXXZL.shehao '
      
        'where ZLZLS3.TCLYL>0 and ZLZLS3.ZLBH1='#39'Y2203-0555'#39' and ZLZLS3.CQ' +
        'DH='#39'VR1'#39
      '      and ZLZLS3.CLDHZ like '#39'AW126000003%'#39' '
      
        'GROUP BY  ZLZLS3.cldhz,ZLZLS3.ZLBH1,CLZL.zwpm,CLZL.ywpm,DDZL.CQD' +
        'H,CLZL.DWBH,KFXXZL.Article, KFXXZL.XieMing,ERP_DDZL.Quantity ) Z' +
        'LZLS3'
      'left join ('
      
        '           select KCLLS.SCBH,KCLLS.CLBH,round(sum(case when KCLL' +
        '.CFMID<>'#39'NO'#39' then KCLLS.Qty else 0 end),2) as Qty,round(sum(KCLL' +
        'S.TempQty),2) as TempQty,'
      
        '                  round(sum(case when KCLL.CFMID<>'#39'NO'#39' then KCLL' +
        'S.Qty else 0 end),2) as RKQty,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 ' +
        'end ) as NK,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 ' +
        'end ) as TC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 end ' +
        ') as HD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 end ' +
        ') as KD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 end ' +
        ') as GC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 end ' +
        ') as XT,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'NQ'#39' then Qty else 0 end ' +
        ') as NQ,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else 0 en' +
        'd ) as ZZ,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO e' +
        'nd) as CNO_NK,'
      
        '                  Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO e' +
        'nd) as CNO_TC,'
      
        '                  Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO e' +
        'nd) as CNO_HD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO e' +
        'nd) as CNO_KD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NQ'#39' then KCLLS.CNO e' +
        'nd) as CNO_NQ'
      
        '           from KCLLS left join KCLL on KCLL.LLNO=KCLLS.LLNO    ' +
        '   '
      '           where 1=1 '
      '                 and KCLL.GSBH='#39'VR1'#39' '
      '                 and KCLLS.SCBH ='#39'Y2203-0555'#39' '
      
        '           group by KCLLS.SCBH,KCLLS.CLBH ) KCLLS on KCLLS.SCBH=' +
        'ZLZLS3.ZLBH1 and KCLLS.CLBH=ZLZLS3.CLDHZ '
      'union all '
      
        'select ZLZLS3.*,KCLLS.TempQty,KCLLS.CNO_NK,KCLLS.CNO_TC,KCLLS.CN' +
        'O_HD,KCLLS.CNO_KD,KCLLS.CNO_NQ,KCLLS.RKQty,IsNull(KCLLS.NK,0) as' +
        ' NK,IsNull(KCLLS.TC,0) as TC,IsNull(KCLLS.HD,0) as HD,IsNull(KCL' +
        'LS.KD,0) as KD,IsNull(KCLLS.XT,0) as XT,IsNull(KCLLS.GC,0) as GC' +
        ',IsNull(KCLLS.NQ,0) as NQ,'
      
        '       KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.TC,0)-IsNull(KC' +
        'LLS.HD,0)-IsNull(KCLLS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLLS.GC,' +
        '0)-IsNull(KCLLS.NQ,0) as ZZ,KCLLS.Qty'
      ' from ('
      
        'select ZLZLS3.ZLBH1 as ZLBH1,right(ZLZLS3.cldhz,10) as MJBH,righ' +
        't(ZLZLS3.cldhz,10) as Parent,'#39'Assembly'#39' as DType,right(ZLZLS3.cl' +
        'dhz,10) as cldhz,convert(float,round(sum(ZLZLS3.TCLYL),2)) as TC' +
        'LYL,'
      
        '      CLZL.ywpm,CLZL.DWBH,KFXXZL.Article,KFXXZL.XieMing,IsNull(E' +
        'RP_DDZL.Quantity,Max(DDZL.Pairs)) as Quantity,max(convert(varcha' +
        'r,cast(ZLZLS3.USERDATE as smalldatetime),111)) as CalDate,DDZL.C' +
        'QDH'
      'FROM LIY_DD.dbo.ZLZLS3  ZLZLS3'
      
        'LEFT JOIN LIY_DD.dbo.DDZL DDZL ON ZLZLS3.DDBH = DDZL.DDBH AND DD' +
        'ZL.CQDH = ZLZLS3.CQDH LEFT JOIN LIY_DD.dbo.CLZL CLZL ON ZLZLS3.c' +
        'ldhz = CLZL.cldh '
      
        'left join CLZL ERP_CLZL on ERP_CLZL.CLDH=Substring(ZLZLS3.cldhz,' +
        '2,10)'
      'Left join YPZL ERP_DDZL on ERP_DDZL.YPDH=DDZL.ZLBH1 '
      
        'left join KFXXZL on ERP_DDZL.XieXing=KFXXZL.XieXing and ERP_DDZL' +
        '.Shehao=KFXXZL.shehao '
      
        'where ZLZLS3.TCLYL>0 and ZLZLS3.ZLBH1='#39'Y2203-0555'#39' and ZLZLS3.CQ' +
        'DH='#39'VR2'#39
      '      and ZLZLS3.CLDHZ like '#39'AW126000003%'#39' '
      
        'GROUP BY  ZLZLS3.cldhz,ZLZLS3.ZLBH1,CLZL.zwpm,CLZL.ywpm,DDZL.CQD' +
        'H,CLZL.DWBH,KFXXZL.Article, KFXXZL.XieMing,ERP_DDZL.Quantity ) Z' +
        'LZLS3'
      'left join ('
      
        '           select KCLLS.SCBH,KCLLS.CLBH,round(sum(case when KCLL' +
        '.CFMID<>'#39'NO'#39' then KCLLS.Qty else 0 end),2) as Qty,round(sum(KCLL' +
        'S.TempQty),2) as TempQty,'
      
        '                  round(sum(case when KCLL.CFMID<>'#39'NO'#39' then KCLL' +
        'S.Qty else 0 end),2) as RKQty,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 ' +
        'end ) as NK,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 ' +
        'end ) as TC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 end ' +
        ') as HD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 end ' +
        ') as KD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 end ' +
        ') as GC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 end ' +
        ') as XT,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'NQ'#39' then Qty else 0 end ' +
        ') as NQ,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else 0 en' +
        'd ) as ZZ,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO e' +
        'nd) as CNO_NK,'
      
        '                  Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO e' +
        'nd) as CNO_TC,'
      
        '                  Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO e' +
        'nd) as CNO_HD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO e' +
        'nd) as CNO_KD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NQ'#39' then KCLLS.CNO e' +
        'nd) as CNO_NQ'
      
        '           from KCLLS left join KCLL on KCLL.LLNO=KCLLS.LLNO    ' +
        '   '
      '           where 1=1 '
      '                 and KCLL.GSBH='#39'VR2'#39' '
      '                 and KCLLS.SCBH ='#39'Y2203-0555'#39' '
      
        '           group by KCLLS.SCBH,KCLLS.CLBH ) KCLLS on KCLLS.SCBH=' +
        'ZLZLS3.ZLBH1 and KCLLS.CLBH=ZLZLS3.CLDHZ '
      'union all '
      
        'select ZLZLS3.*,KCLLS.TempQty,KCLLS.CNO_NK,KCLLS.CNO_TC,KCLLS.CN' +
        'O_HD,KCLLS.CNO_KD,KCLLS.CNO_NQ,KCLLS.RKQty,IsNull(KCLLS.NK,0) as' +
        ' NK,IsNull(KCLLS.TC,0) as TC,IsNull(KCLLS.HD,0) as HD,IsNull(KCL' +
        'LS.KD,0) as KD,IsNull(KCLLS.XT,0) as XT,IsNull(KCLLS.GC,0) as GC' +
        ',IsNull(KCLLS.NQ,0) as NQ,'
      
        '       KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.TC,0)-IsNull(KC' +
        'LLS.HD,0)-IsNull(KCLLS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLLS.GC,' +
        '0)-IsNull(KCLLS.NQ,0) as ZZ,KCLLS.Qty'
      ' from ('
      
        'select ZLZLS3.ZLBH1 as ZLBH1,right(ZLZLS3.cldhz,10) as MJBH,righ' +
        't(ZLZLS3.cldhz,10) as Parent,'#39'Assembly'#39' as DType,right(ZLZLS3.cl' +
        'dhz,10) as cldhz,convert(float,round(sum(ZLZLS3.TCLYL),2)) as TC' +
        'LYL,'
      
        '      CLZL.ywpm,CLZL.DWBH,KFXXZL.Article,KFXXZL.XieMing,IsNull(E' +
        'RP_DDZL.Quantity,Max(DDZL.Pairs)) as Quantity,max(convert(varcha' +
        'r,cast(ZLZLS3.USERDATE as smalldatetime),111)) as CalDate,DDZL.C' +
        'QDH'
      'FROM LIY_DD.dbo.ZLZLS3  ZLZLS3'
      
        'LEFT JOIN LIY_DD.dbo.DDZL DDZL ON ZLZLS3.DDBH = DDZL.DDBH AND DD' +
        'ZL.CQDH = ZLZLS3.CQDH LEFT JOIN LIY_DD.dbo.CLZL CLZL ON ZLZLS3.c' +
        'ldhz = CLZL.cldh '
      
        'left join CLZL ERP_CLZL on ERP_CLZL.CLDH=Substring(ZLZLS3.cldhz,' +
        '2,10)'
      'Left join YPZL ERP_DDZL on ERP_DDZL.YPDH=DDZL.ZLBH1 '
      
        'left join KFXXZL on ERP_DDZL.XieXing=KFXXZL.XieXing and ERP_DDZL' +
        '.Shehao=KFXXZL.shehao '
      
        'where ZLZLS3.TCLYL>0 and ZLZLS3.ZLBH1='#39'Y2203-0555'#39' and ZLZLS3.CQ' +
        'DH='#39'VR3'#39
      '      and ZLZLS3.CLDHZ like '#39'AW126000003%'#39' '
      
        'GROUP BY  ZLZLS3.cldhz,ZLZLS3.ZLBH1,CLZL.zwpm,CLZL.ywpm,DDZL.CQD' +
        'H,CLZL.DWBH,KFXXZL.Article, KFXXZL.XieMing,ERP_DDZL.Quantity ) Z' +
        'LZLS3'
      'left join ('
      
        '           select KCLLS.SCBH,KCLLS.CLBH,round(sum(case when KCLL' +
        '.CFMID<>'#39'NO'#39' then KCLLS.Qty else 0 end),2) as Qty,round(sum(KCLL' +
        'S.TempQty),2) as TempQty,'
      
        '                  round(sum(case when KCLL.CFMID<>'#39'NO'#39' then KCLL' +
        'S.Qty else 0 end),2) as RKQty,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 ' +
        'end ) as NK,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 ' +
        'end ) as TC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 end ' +
        ') as HD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 end ' +
        ') as KD,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 end ' +
        ') as GC,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 end ' +
        ') as XT,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'NQ'#39' then Qty else 0 end ' +
        ') as NQ,'
      
        #9#9#9#9#9'         Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else 0 en' +
        'd ) as ZZ,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO e' +
        'nd) as CNO_NK,'
      
        '                  Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO e' +
        'nd) as CNO_TC,'
      
        '                  Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO e' +
        'nd) as CNO_HD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO e' +
        'nd) as CNO_KD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NQ'#39' then KCLLS.CNO e' +
        'nd) as CNO_NQ'
      
        '           from KCLLS left join KCLL on KCLL.LLNO=KCLLS.LLNO    ' +
        '   '
      '           where 1=1 '
      '                 and KCLL.GSBH='#39'VR3'#39' '
      '                 and KCLLS.SCBH ='#39'Y2203-0555'#39' '
      
        '           group by KCLLS.SCBH,KCLLS.CLBH ) KCLLS on KCLLS.SCBH=' +
        'ZLZLS3.ZLBH1 and KCLLS.CLBH=ZLZLS3.CLDHZ '
      'union all'
      
        'select KCLLS.SCBH as ZLBH1,case when len(KCLLS.DFL)<10 then KCLL' +
        'S.CLBH else KCLLS.DFL end as MJBH,KCLLS.CLBH as Parent,Case when' +
        ' len(KCLLS.DFL)<10 then '#39'Assembly'#39' else '#39'Gia cong'#39'  end as DType' +
        ','
      
        '       KCLLS.CLBH as cldhz,0 as TCLYL,CLZL.YWPM,CLZL.DWBH,DDZL.A' +
        'rticle,XXZL.XieMing,DDZL.Pairs,null as CalDate,KCLL.GSBH as CQDH' +
        ',KCLLS.TempQty'
      
        '       ,KCRKCX.CNO_NK,KCRKCX.CNO_TC,KCRKCX.CNO_HD,KCRKCX.CNO_KD,' +
        'KCRKCX.CNO_NQ,KCRKCX.RKQty,IsNull(KCRKCX.NK,0) as NK,IsNull(KCRK' +
        'CX.TC,0) as TC,IsNull(KCRKCX.HD,0) as HD,IsNull(KCRKCX.KD,0) as ' +
        'KD,IsNull(KCRKCX.XT,0) as XT,IsNull(KCRKCX.GC,0) as GC,IsNull(KC' +
        'RKCX.NQ,0) as NQ'
      
        '       ,KCLLS.Qty-IsNull(KCRKCX.NK,0)-IsNull(KCRKCX.TC,0)-IsNull' +
        '(KCRKCX.HD,0)-IsNull(KCRKCX.KD,0)-IsNull(KCRKCX.XT,0)-IsNull(KCR' +
        'KCX.GC,0)-IsNull(KCRKCX.NQ,0) as ZZ'
      '       ,KCLLS.Qty'
      'from  KCLLS'
      'left join DDZL on DDZL.DDBH=KCLLS.SCBH'
      
        'left join XXZL on DDZL.XieXing=xxzl.XieXing and DDZL.Shehao=xxzl' +
        '.shehao'
      'left join CLZL on CLZL.CLDH=KCLLS.CLBH'
      'left join KCLL on KCLL.LLNO=KCLLS.LLNO  '
      'left join ( '
      
        '          select KCLLS.LLNO,KCLLS.CLBH,KCLLS.SCBH,KCLLS.DFL,Sum(' +
        'KCLLS.Qty) as RKQty,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 ' +
        'end ) as NK, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 ' +
        'end ) as TC, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 ' +
        'end ) as HD, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 ' +
        'end ) as KD, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 ' +
        'end ) as XT, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 ' +
        'end ) as GC,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NQ'#39' then Qty else 0 ' +
        'end ) as NQ, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else ' +
        '0 end ) as ZZ, '
      
        '                  Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO e' +
        'nd) as CNO_NK, '
      
        '                  Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO e' +
        'nd) as CNO_TC, '
      
        '                  Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO e' +
        'nd) as CNO_HD, '
      
        '                  Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO e' +
        'nd) as CNO_KD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NQ'#39' then KCLLS.CNO e' +
        'nd) as CNO_NQ '
      '           from KCLLS '
      '           where KCLLS.SCBH = '#39'Y2203-0555'#39' '
      '                 and KCLLS.CLBH like '#39'W126000003%'#39' '
      '           Group by KCLLS.LLNO,KCLLS.CLBH,KCLLS.SCBH,KCLLS.DFL '
      
        '           ) KCRKCX on KCRKCX.LLNO=KCLLS.LLNO and KCRKCX.CLBH=KC' +
        'LLS.CLBH and KCRKCX.DFL=KCLLS.DFL and KCRKCX.SCBH=KCLLS.SCBH '
      'WHERE KCLL.GSBH ='#39'CDC'#39' and KCLL.CFMID<>'#39'NO'#39' '
      '      and NOT EXISTS ( select * from (select CLBH from ('
      '      SELECT ypzls.CLBH '
      '      FROM ypzls ypzls '
      '      WHERE YPDH = '#39'Y2203-0555'#39' '
      '      union all '
      '      SELECT clzhzl.CLDH1 as CLBH'
      '      FROM ypzls ypzls '
      '      Left join clzhzl ON  ypzls.CLBH = CLZHZL.cldh '
      '      WHERE YPDH = '#39'Y2203-0555'#39'  and CLZHZL.SYL>0  '
      '      union all'
      '      Select clzhzl.CLDH1 as CLBH '
      '       from ('
      '      SELECT clzhzl.CLDH1 as CLBH'
      '      FROM ypzls ypzls '
      '      inner join clzhzl ON  ypzls.CLBH = CLZHZL.cldh '
      '      left JOIN clzl clzl ON CLZHZL.cldh1 = clzl.cldh'
      
        '      WHERE YPDH = '#39'Y2203-0555'#39'  and CLZHZL.SYL>0   and clzl.clz' +
        'mlb='#39'Y'#39'  '
      '      ) clzhzl2'
      
        '      inner join clzhzl ON  clzhzl2.CLBH = CLZHZL.cldh  ) YPZLS ' +
        'Group by CLBH ) YPZLS where KCLLS.CLBH=YPZLS.CLBH) '
      
        '   and KCLLS.SCBH like '#39'Y2203-0555'#39' and KCLLS.CLBH like '#39'W126000' +
        '003%'#39' and KCLLS.Qty>0'
      'union all'
      
        'select KCLLS.SCBH as ZLBH1,KCLLS.CLBH as MJBH,KCLLS.CLBH as Pare' +
        'nt,'#39'Assembly'#39' as DType,KCLLS.CLBH as cldhz,0 as TCLYL,CLZL.YWPM,' +
        'CLZL.DWBH,DDZL.Article,XXZL.XieMing,DDZL.Pairs,null as CalDate,K' +
        'CLL.GSBH as CQDH,KCLLS.TempQty'
      
        '       ,KCRKCX.CNO_NK,KCRKCX.CNO_TC,KCRKCX.CNO_HD,KCRKCX.CNO_KD,' +
        'KCRKCX.CNO_NQ,KCRKCX.RKQty,IsNull(KCRKCX.NK,0) as NK,IsNull(KCRK' +
        'CX.TC,0) as TC,IsNull(KCRKCX.HD,0) as HD,IsNull(KCRKCX.KD,0) as ' +
        'KD,IsNull(KCRKCX.XT,0) as XT,IsNull(KCRKCX.GC,0) as GC,IsNull(KC' +
        'RKCX.NQ,0) as NQ'
      
        '       ,KCLLS.Qty-IsNull(KCRKCX.NK,0)-IsNull(KCRKCX.TC,0)-IsNull' +
        '(KCRKCX.HD,0)-IsNull(KCRKCX.KD,0)-IsNull(KCRKCX.XT,0)-IsNull(KCR' +
        'KCX.GC,0)-IsNull(KCRKCX.NQ,0) as ZZ'
      '       ,KCLLS.Qty'
      'from  KCLLS'
      'left join DDZL on DDZL.DDBH=KCLLS.SCBH'
      
        'left join XXZL on DDZL.XieXing=xxzl.XieXing and DDZL.Shehao=xxzl' +
        '.shehao'
      'left join CLZL on CLZL.CLDH=KCLLS.CLBH'
      'left join KCLL on KCLL.LLNO=KCLLS.LLNO  '
      'left join ( '
      
        '          select KCLLS.LLNO,KCLLS.CLBH,KCLLS.SCBH,KCLLS.DFL,Sum(' +
        'KCLLS.Qty) as RKQty,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NK'#39' then Qty else 0 ' +
        'end ) as NK, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'TC'#39' then Qty else 0 ' +
        'end ) as TC, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'HD'#39' then Qty else 0 ' +
        'end ) as HD, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'KD'#39' then Qty else 0 ' +
        'end ) as KD, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'XT'#39' then Qty else 0 ' +
        'end ) as XT, '
      
        '                  Sum(Case when KCLLS.HGLB='#39'GC'#39' then Qty else 0 ' +
        'end ) as GC,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'NQ'#39' then Qty else 0 ' +
        'end ) as NQ,'
      
        '                  Sum(Case when KCLLS.HGLB='#39'ZZZZ'#39' then Qty else ' +
        '0 end ) as ZZ,  '
      
        '                  Max(Case when KCLLS.HGLB='#39'NK'#39' then KCLLS.CNO e' +
        'nd) as CNO_NK, '
      
        '                  Max(Case when KCLLS.HGLB='#39'TC'#39' then KCLLS.CNO e' +
        'nd) as CNO_TC, '
      
        '                  Max(Case when KCLLS.HGLB='#39'HD'#39' then KCLLS.CNO e' +
        'nd) as CNO_HD, '
      
        '                  Max(Case when KCLLS.HGLB='#39'KD'#39' then KCLLS.CNO e' +
        'nd) as CNO_KD,'
      
        '                  Max(Case when KCLLS.HGLB='#39'NQ'#39' then KCLLS.CNO e' +
        'nd) as CNO_NQ '
      '           from KCLLS left join KCLL on KCLLS.LLNO=KCLL.LLNO '
      '           where KCLLS.SCBH = '#39'Y2203-0555'#39' '
      '                 and KCLLS.CLBH like '#39'W126000003%'#39' '
      '           Group by KCLLS.LLNO,KCLLS.CLBH,KCLLS.SCBH,KCLLS.DFL '
      
        '           ) KCRKCX on KCRKCX.LLNO=KCLLS.LLNO and KCRKCX.CLBH=KC' +
        'LLS.CLBH and KCRKCX.DFL=KCLLS.DFL and KCRKCX.SCBH=KCLLS.SCBH    ' +
        '       '
      
        'WHERE KCLL.GSBH like '#39'VR%'#39' and KCLL.CFMID<>'#39'NO'#39' and NOT EXISTS(S' +
        'ELECT *  FROM LIY_DD.dbo.ZLZLS3  ZLZLS3  WHERE '#39'A'#39'+KCLLS.CLBH=ZL' +
        'ZLS3.CLDHZ AND KCLLS.SCBH=ZLZLS3.ZLBH1 and KCLL.GSBH=ZLZLS3.CQDH' +
        ')'
      
        '   and KCLLS.SCBH like '#39'Y2203-0555'#39' and KCLLS.CLBH like '#39'W126000' +
        '003%'#39' and KCLLS.Qty>0'
      '  ) ZLZLS2    '
      'Left join CLHG on CLHG.CLBH=ZLZLS2.CLBH  '
      'Left join CLHD on CLHD.CLBH=ZLZLS2.CLBH  '
      'Left join CLKD on CLKD.CLBH=ZLZLS2.CLBH  '
      'Left join CLTC on CLTC.CLBH=ZLZLS2.CLBH'
      'Left join CLNQ on CLNQ.CLBH=ZLZLS2.CLBH   '
      'Left join ('
      
        'Select KCRKS.GSBH,KCRKS.CGBH as ZLBH,Case when len(KCRKS.RKSB)<1' +
        '0 then KCRKS.CLBH else KCRKS.RKSB End as MJBH,Case when len(KCRK' +
        'S.RKSB)<10 then '#39'Assembly'#39' else '#39'Gia cong'#39' End as DType ,KCRKS.C' +
        'LBH, '
      '       Sum(KCRKS.Qty) as Qty, '
      
        '       Sum(Case when KCRK.HGLB='#39'NK'#39' then Qty else 0 end ) as NK,' +
        ' '
      
        '       Sum(Case when KCRK.HGLB='#39'TC'#39' then Qty else 0 end ) as TC,' +
        ' '
      
        '       Sum(Case when KCRK.HGLB='#39'HD'#39' then Qty else 0 end ) as HD,' +
        ' '
      
        '       Sum(Case when KCRK.HGLB='#39'KD'#39' then Qty else 0 end ) as KD,' +
        ' '
      
        '       Sum(Case when KCRK.HGLB='#39'XT'#39' then Qty else 0 end ) as XT,' +
        ' '
      '       Sum(Case when KCRK.HGLB='#39'GC'#39' then Qty else 0 end ) as GC,'
      
        '       Sum(Case when KCRK.HGLB='#39'NQ'#39' then Qty else 0 end ) as NQ,' +
        '  '
      
        '       Sum(Case when KCRK.HGLB='#39'ZZZZ'#39' then Qty else 0 end ) as Z' +
        'Z  '
      'from KCRK '
      'left join KCRKS on KCRK.RKNO=KCRKS.RKNO '
      'where KCRK.SFL='#39'THU HOI'#39'  and KCRKS.CGBH='#39'Y2203-0555'#39' '
      'Group by KCRKS.GSBH,KCRKS.CGBH,KCRKS.RKSB,KCRKS.CLBH '
      
        ') KCRKTH on  KCRKTH.ZLBH=ZLZLS2.ZLBH and KCRKTH.CLBH=ZLZLS2.CLBH' +
        ' and KCRKTH.DType=ZLZLS2.DType and KCRKTH.MJBH=ZLZLS2.MJBH  and ' +
        'KCRKTH.GSBH=ZLZLS2.GSBH'
      
        'left join ( select kclls.SCBH, kclls.CLBH,case when KCLLS.DFL='#39'N' +
        #39' then CLBH else DFL end as DFL, LLMemo from kclls where HGLB='#39'K' +
        'D'#39' and LLMemo is not null and kclls.scbh='#39'Y2203-0555'#39' )KCLLMeMo'
      
        '          on KCLLMeMo.SCBH=zlzls2.ZLBH and KCLLMeMo.CLBH=ZLZLS2.' +
        'CLBH and KCLLMeMo.DFL=ZLZLS2.MJBH '
      'where 1=1 '
      
        'Order by ZLZLS2.ZLBH,ZLZLS2.GSBH,ZLZLS2.Parent,ZLZLS2.DType,ZLZL' +
        'S2.CLBH')
    Left = 97
    Top = 213
    object StringField1: TStringField
      FieldName = 'ZLBH'
      FixedChar = True
      Size = 18
    end
    object StringField2: TStringField
      FieldName = 'Parent'
      FixedChar = True
      Size = 16
    end
    object StringField3: TStringField
      FieldName = 'DType'
      FixedChar = True
      Size = 8
    end
    object StringField4: TStringField
      FieldName = 'CLBH'
      FixedChar = True
      Size = 16
    end
    object FloatField1: TFloatField
      FieldName = 'CLSL'
      DisplayFormat = '##,#0.00'
    end
    object StringField5: TStringField
      FieldName = 'YWPM'
      FixedChar = True
      Size = 200
    end
    object StringField6: TStringField
      FieldName = 'DWBH'
      FixedChar = True
      Size = 4
    end
    object StringField7: TStringField
      FieldName = 'Article'
      FixedChar = True
    end
    object StringField8: TStringField
      FieldName = 'XieMing'
      FixedChar = True
      Size = 50
    end
    object CurrencyField1: TCurrencyField
      FieldName = 'TempQty'
      DisplayFormat = '##,#0.00'
    end
    object CurrencyField2: TCurrencyField
      FieldName = 'Qty'
      DisplayFormat = '##,#0.00'
    end
    object FloatField2: TFloatField
      FieldKind = fkCalculated
      FieldName = 'Person'
      DisplayFormat = '#,##0.0%'
      Calculated = True
    end
    object RYQueryQuantity: TFloatField
      FieldName = 'Quantity'
    end
    object RYQueryRate_HG: TFloatField
      FieldName = 'Rate_HG'
    end
    object RYQueryHG_NO: TStringField
      FieldName = 'HG_NO'
      FixedChar = True
      Size = 15
    end
    object RYQueryRate_TC: TFloatField
      FieldName = 'Rate_TC'
    end
    object RYQueryTC_NO: TStringField
      FieldName = 'TC_NO'
      FixedChar = True
      Size = 15
    end
    object RYQueryRate_HD: TFloatField
      FieldName = 'Rate_HD'
    end
    object RYQueryHD_NO: TStringField
      FieldName = 'HD_NO'
      FixedChar = True
      Size = 15
    end
    object RYQueryRate_KD: TFloatField
      FieldName = 'Rate_KD'
    end
    object RYQueryKD_NO: TStringField
      FieldName = 'KD_NO'
      FixedChar = True
      Size = 15
    end
    object CurrencyField3: TCurrencyField
      FieldName = 'NK'
      DisplayFormat = '#0.00'
    end
    object RYQueryTC: TCurrencyField
      FieldName = 'TC'
      DisplayFormat = '#0.00'
    end
    object CurrencyField4: TCurrencyField
      FieldName = 'HD'
      DisplayFormat = '#0.00'
    end
    object CurrencyField5: TCurrencyField
      FieldName = 'KD'
      DisplayFormat = '#0.00'
    end
    object CurrencyField6: TCurrencyField
      FieldName = 'XT'
      DisplayFormat = '#0.00'
    end
    object CurrencyField7: TCurrencyField
      FieldName = 'GC'
      DisplayFormat = '#0.00'
    end
    object CurrencyField8: TCurrencyField
      FieldName = 'ZZ'
      DisplayFormat = '#0.00'
    end
    object FloatField3: TFloatField
      FieldName = 'RKQty'
    end
    object RYQueryTHQty: TCurrencyField
      FieldName = 'THQty'
      DisplayFormat = '#0.00'
    end
    object RYQueryLLMemo: TStringField
      FieldName = 'LLMemo'
      FixedChar = True
      Size = 200
    end
    object StringField11: TStringField
      FieldName = 'MJBH'
      FixedChar = True
      Size = 16
    end
    object StringField10: TStringField
      FieldName = 'GSBH'
      FixedChar = True
      Size = 4
    end
    object RYQueryCalDate: TStringField
      FieldName = 'CalDate'
      FixedChar = True
      Size = 30
    end
    object RYQueryRate_HG1: TFloatField
      FieldName = 'Rate_HG1'
    end
    object RYQueryHG1_NO: TStringField
      FieldName = 'HG1_NO'
      Size = 40
    end
    object RYQueryRate_TC1: TFloatField
      FieldName = 'Rate_TC1'
    end
    object RYQueryTC1_NO: TStringField
      FieldName = 'TC1_NO'
      Size = 40
    end
    object RYQueryRate_HD1: TFloatField
      FieldName = 'Rate_HD1'
    end
    object RYQueryHD1_NO: TStringField
      FieldName = 'HD1_NO'
      Size = 40
    end
    object RYQueryRate_KD1: TFloatField
      FieldName = 'Rate_KD1'
    end
    object RYQueryKD1_NO: TStringField
      FieldName = 'KD1_NO'
      Size = 40
    end
    object RYQueryRate_NQ: TFloatField
      FieldName = 'Rate_NQ'
    end
    object RYQueryNQ_NO: TStringField
      FieldName = 'NQ_NO'
      FixedChar = True
      Size = 15
    end
    object RYQueryRate_NKNQ: TFloatField
      FieldName = 'Rate_NKNQ'
    end
    object RYQueryNKNQ_NO: TStringField
      FieldName = 'NKNQ_NO'
      Size = 40
    end
    object RYQueryNK1: TCurrencyField
      FieldName = 'NK1'
      DisplayFormat = '#0.00'
    end
    object RYQueryTC1: TCurrencyField
      FieldName = 'TC1'
      DisplayFormat = '#0.00'
    end
    object RYQueryHD1: TCurrencyField
      FieldName = 'HD1'
      DisplayFormat = '#0.00'
    end
    object RYQueryKD1: TCurrencyField
      FieldName = 'KD1'
      DisplayFormat = '#0.00'
    end
    object RYQueryH11: TCurrencyField
      FieldName = 'H11'
      DisplayFormat = '#0.00'
    end
    object RYQueryNQ: TCurrencyField
      FieldName = 'NQ'
      DisplayFormat = '#0.00'
    end
    object RYQueryNKNQ: TCurrencyField
      FieldName = 'NKNQ'
      DisplayFormat = '#0.00'
    end
  end
  object RYDS: TDataSource
    DataSet = RYQuery
    Left = 99
    Top = 247
  end
  object Qtemp: TQuery
    DatabaseName = 'DB'
    SQL.Strings = (
      
        'Select CNO,Max(DWBH) as DWBH,Round(Round(Sum(CLSL)/Max(Pairs),4)' +
        '*IsNull(Max(CLHG.RateC),1),6) as CLSL'
      
        '          ,Round(Round(Sum(Qty)/Max(Pairs),4)*IsNull(Max(CLHG.Ra' +
        'teC),1),6) as Qty '
      
        '          ,Round(Round(Sum(NK)/Max(Pairs),4)*IsNull(Max(CLHG.Rat' +
        'eC),1),6) as NK '
      
        '          ,Round(Round(Sum(HD)/Max(Pairs),4)*IsNull(Max(CLHG.Rat' +
        'eC),1),6) as HD '
      
        '          ,Round(Round(Sum(KD)/Max(Pairs),4)*IsNull(Max(CLHG.Rat' +
        'eC),1),6) as KD '
      
        '          ,Round(Round(Sum(XT)/Max(Pairs),4)*IsNull(Max(CLHG.Rat' +
        'eC),1),6) as XT '
      
        '          ,Round(Round(Sum(GC)/Max(Pairs),4)*IsNull(Max(CLHG.Rat' +
        'eC),1),6) as GC'
      
        '          ,Round(Round(Sum(ZZ)/Max(Pairs),4)*IsNull(Max(CLHG.Rat' +
        'eC),1),6) as ZZ'
      '           from ('
      
        'select OrdCL.*,Round(KCLLS.TempQty,2) as TempQty ,case when KCLL' +
        'S.CNO='#39#39' then null else CNO end CNO,KCLLS.RKQty,IsNull(KCLLS.NK,' +
        '0) as NK,IsNull(KCLLS.HD,0) as HD,IsNull(KCLLS.KD,0) as KD,IsNul' +
        'l(KCLLS.XT,0) as XT,IsNull(KCLLS.GC,0) as GC,'
      
        'Case when KCLLS.DType='#39'Assembly'#39' then Round(KCLLS.Qty-IsNull(KCL' +
        'LS.NK,0)-IsNull(KCLLS.HD,0)-IsNull(KCLLS.KD,0)-IsNull(KCLLS.XT,0' +
        ')-IsNull(KCLLS.GC,0),2) '
      
        '     when KCLLS.DType='#39'Gia cong'#39' and KCLLS.Qty=0 then Round(IsNu' +
        'll(KCLLS.Qty,0)-IsNull(KCLLS.NK,0)-IsNull(KCLLS.HD,0)-IsNull(KCL' +
        'LS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLLS.GC,0),2)'
      
        '      else Round((IsNull(KCLLS.Qty,CLSL)-IsNull(KCLLS.NK,0)-IsNu' +
        'll(KCLLS.HD,0)-IsNull(KCLLS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLL' +
        'S.GC,0) ),2) end as ZZ,       '
      
        'Case when KCLLS.DType='#39'Assembly'#39' then KCLLS.Qty  when KCLLS.DTyp' +
        'e='#39'Gia cong'#39' and KCLLS.Qty=0 then Round(IsNull(KCLLS.Qty,0),2) e' +
        'lse Round(IsNull(KCLLS.Qty,CLSL),2) end as Qty'
      
        'from (select ZLZLS2.ZLBH,ZLZLS2.CLBH as MJBH,ZLZLS2.CLBH as Pare' +
        'nt,'#39'Assembly'#39' as DType,ZLZLS2.CLBH,'
      
        '             sum(ZLZLS2.CLSL) as CLSL,CLZL.YWPM,CLZL.DWBH,XXZL.A' +
        'rticle,XXZL.XieMing,DDZL.Pairs,Max(ZLZLS2.USERDATE) as CalDate,D' +
        'DZL.GSBH '
      '      from DDZL_ZLZLS2 as ZLZLS2'
      '      left join CLZL on ZLZLS2.CLBH=CLZL.CLDH'
      '      left join ZLZL on ZLZL.ZLBH=ZLZLS2.ZLBH'
      '      left join  DDZL on DDZL.DDBH=ZLZL.DDBH'
      
        '      left join XXZl on XXZL.XieXing=DDZl.XieXing and XXZl.Sheha' +
        'o=DDZL.SheHao'
      '      where 1=1'
      '      and ZLZLS2.ZLBH = '#39'Y1709-0178'#39' '
      '      and MJBH='#39'ZZZZZZZZZZ'#39
      '      and DDZL.DDZT='#39'Y'#39
      '      and DDZl.GSBH='#39'VA12'#39' '
      
        '      group by ZLZLS2.ZLBH,ZLZLS2.CLBH,CLZL.YWPM,CLZL.DWBH,XXZL.' +
        'Article,XXZL.XieMing,DDZL.Pairs,DDZL.GSBH '
      'union all '
      
        '   select ZLZLS2.ZLBH,ZLZLS2.MJBH,(select top 1 Case when  A.MJB' +
        'H<>'#39'ZZZZZZZZZZ'#39' then A.MJBH else ZLZLS2.MJBH end as MJBH from ZL' +
        'ZLS2 A where A.CLBH=ZLZLS2.MJBH and A.ZLBH=ZLZLS2.ZLBH  ) as Par' +
        'ent,'#39'Gia cong'#39' as DType,ZLZLS2.CLBH,'
      
        '             sum(ZLZLS2.CLSL)   CLSL,CLZL.YWPM,CLZL.DWBH,XXZL.Ar' +
        'ticle,XXZL.XieMing,DDZL.Pairs,Max(ZLZLS2.USERDATE) as CalDate,DD' +
        'ZL.GSBH '
      '    from DDZL_ZLZLS2 as ZLZLS2'
      '      left join CLZL on ZLZLS2.CLBH=CLZL.CLDH'
      '      left join ZLZL on ZLZL.ZLBH=ZLZLS2.ZLBH'
      '      left join  DDZL on DDZL.DDBH=ZLZL.DDBH'
      
        '      left join XXZl on XXZL.XieXing=DDZl.XieXing and XXZl.Sheha' +
        'o=DDZL.SheHao'
      '      where 1=1'
      '      and ZLZLS2.ZLBH = '#39'Y1709-0178'#39' '
      '      and MJBH<>'#39'ZZZZZZZZZZ'#39
      '      and DDZL.DDZT='#39'Y'#39
      '      and DDZl.GSBH='#39'VA12'#39' '
      
        '    group by ZLZLS2.ZLBH,ZLZLS2.MJBH,ZLZLS2.CLBH,CLZL.YWPM,CLZL.' +
        'DWBH,XXZL.Article,XXZL.XieMing,DDZL.Pairs,DDZL.GSBH '
      ') OrdCL'
      'left join ('
      
        '      select SCBH,CLBH,MJBH,DType,Sum(Qty) as Qty,Sum(TempQty) a' +
        's TempQty,Max(CNO) as CNO,Sum(RKQty) as RKQty,'
      
        '                  Sum(NK) as NK,Sum(HD) as HD,Sum(KD) as KD,Sum(' +
        'XT) as XT,Sum(GC) as GC,Sum(ZZ) as ZZ from ('
      '                  '
      
        #9#9'   select  KCLLS.LLNO,KCLLS.SCBH, KCLLS.CLBH,KCLLS.CLBH as MJB' +
        'H,'#39'Assembly'#39' as DType, sum(KCLLS.Qty) as Qty, sum(KCLLS.TempQty)' +
        ' as TempQty,'
      
        #9#9#9#9#9'KCRKCX.CNO,Max(KCRKCX.RKQty) as RKQty,Max(KCRKCX.NK) as NK,' +
        'Max(KCRKCX.HD) as HD,Max(KCRKCX.KD) as KD,'
      
        #9#9#9#9#9'Max(KCRKCX.XT) as XT,Max(KCRKCX.GC) as GC,Max(KCRKCX.ZZ) as' +
        ' ZZ  '
      #9#9'   from KCLLS'
      '           left join KCLL on KCLL.LLNO=KCLLS.LLNO'
      #9#9'   left join DDZL on DDZL.DDBH=KCLLS.SCBH'
      #9#9'   left join CLZL on CLZL.CLDH=KCLLS.CLBH'
      #9#9'   left join (                    '
      
        '           select KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.DFL' +
        ',Max(KCRKS.CNO) as CNO,Sum(RKQty) as RKQty,'
      
        '                  Sum(Case when KCRK.HGLB='#39'NK'#39' then RKQty else 0' +
        ' end ) as NK, '
      
        '                  Sum(Case when KCRK.HGLB='#39'HD'#39' then RKQty else 0' +
        ' end ) as HD, '
      
        '                  Sum(Case when KCRK.HGLB='#39'KD'#39' then RKQty else 0' +
        ' end ) as KD, '
      
        '                  Sum(Case when KCRK.HGLB='#39'XT'#39' then RKQty else 0' +
        ' end ) as XT, '
      
        '                  Sum(Case when KCRK.HGLB='#39'GC'#39' then RKQty else 0' +
        ' end ) as GC,'
      
        '                  Sum(Case when KCRK.HGLB='#39'ZZZZ'#39' then RKQty else' +
        ' 0 end ) as ZZ  '
      '           from KCRKCX '
      
        '           Left join KCRKS on KCRKS.RKNO=KCRKCX.RKNO and KCRKS.C' +
        'LBH=KCRKCX.CLDH and KCRKS.CGBH=KCRKCX.CGBH and KCRKS.RKSB=KCRKCX' +
        '.RKSB'
      '           Left join KCRK on KCRK.RKNO=KCRKCX.RKNO'
      
        '           where KCRKCX.SCBH = '#39'Y1709-0178'#39' and KCRKCX.DFL<>'#39'JGC' +
        'K'#39' and KCRKCX.RKSB<>'#39'JGRK'#39'  '
      
        '           Group by KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.D' +
        'FL          '
      '           union all'
      
        '           select KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.DFL' +
        ',null as CNO,Sum(RKQty) as RKQty,'
      '           null as NK, '
      '           null as HD,'
      '           null as KD, '
      '           null as  XT, '
      '           Sum(RKQty) as GC,'
      '           null as ZZ  '
      '           from KCRKCX '
      
        '           where KCRKCX.SCBH = '#39'Y1709-0178'#39' and KCRKCX.DFL<>'#39'JGC' +
        'K'#39' and KCRKCX.RKSB='#39'JGRK'#39' '
      
        '           Group by KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.D' +
        'FL'
      '           '
      
        '           ) KCRKCX on KCRKCX.LLNO=KCLLS.LLNO and KCRKCX.CLBH=KC' +
        'LLS.CLBH and KCRKCX.DFL=KCLLS.DFL and KCRKCX.SCBH=KCLLS.SCBH'
      #9#9'   where  KCLLS.CLBH like '#39'%'#39
      #9#9#9#9'  and KCLLS.SCBH = '#39'Y1709-0178'#39' '
      #9#9#9#9'  and DDZl.GSBH='#39'VA12'#39' '
      '           and KCLL.GSBH='#39'VA12'#39' and KCLL.CFMID<>'#39'NO'#39' '
      
        #9#9'   group by KCLLS.LLNO,KCLLS.SCBH, KCLLS.CLBH,KCRKCX.CNO,KCRKC' +
        'X.RKQty  '
      '         '
      '           ------'
      '           Union all '
      '           ------'
      
        '           select JGZLSS.JGNO,JGZLSS.ZLBH as SCBH,JGZLS.ZMLB as ' +
        'CLBH,JGZLS.CLBH as MJBH,'#39'Gia cong'#39' as DType,Sum(JGZLS.Qty*JGZLSS' +
        '.Qty) as Qty,Sum(JGZLS.Qty*JGZLSS.Qty) as TempQty, '
      
        '                  KCRKCX.CNO,KCRKCX.RKQty,Max(KCRKCX.NK) as NK,M' +
        'ax(KCRKCX.HD) as HD,Max(KCRKCX.KD) as KD,Max(KCRKCX.XT) as XT,Ma' +
        'x(KCRKCX.GC) as GC,'
      '                  Max(KCRKCX.ZZ) as ZZ          '
      '           from JGZLS'
      
        '           Left Join JGZLSS on JGZLS.JGNO=JGZLSS.JGNO and JGZLS.' +
        'CLBH=JGZLSS.CLBH '
      '           Left join DDZL on DDZL.DDBH=JGZLSS.ZLBH'
      '           Left join JGZL on JGZL.JGNO=JGZLS.JGNO '
      '           left join (          '
      
        '           select KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.DFL' +
        ',KCRKCX.ZLBH,Max(KCRKCX.CNO) as CNO,Sum(KCRKCX.RKQty) as RKQty,'
      
        '                  Sum(Case when KCRKCX.HGLB='#39'NK'#39' then KCRKCX.RKQ' +
        'ty else 0 end ) as NK, '
      
        '                  Sum(Case when KCRKCX.HGLB='#39'HD'#39' then KCRKCX.RKQ' +
        'ty else 0 end ) as HD, '
      
        '                  Sum(Case when KCRKCX.HGLB='#39'KD'#39' then KCRKCX.RKQ' +
        'ty else 0 end ) as KD, '
      
        '                  Sum(Case when KCRKCX.HGLB='#39'XT'#39' then KCRKCX.RKQ' +
        'ty else 0 end ) as XT, '
      
        '                  Sum(Case when KCRKCX.HGLB='#39'GC'#39' then KCRKCX.RKQ' +
        'ty else 0 end ) as GC,'
      
        '                  Sum(Case when KCRKCX.HGLB='#39'ZZZZ'#39' then KCRKCX.R' +
        'KQty else 0 end ) as ZZ '
      
        '           from ( select KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCR' +
        'KCX.DFL,JGZLS.ZLBH,Max(KCRKS.CNO) as CNO,JGZLS.RKQty,Max(KCRK.HG' +
        'LB) as HGLB '
      '           from KCRKCX '
      
        '           left join KCRKS on KCRKS.RKNO=KCRKCX.RKNO and KCRKS.C' +
        'LBH=KCRKCX.CLDH and KCRKS.CGBH=KCRKCX.CGBH and KCRKS.RKSB=KCRKCX' +
        '.RKSB'
      '           left join KCRK on KCRK.RKNO=KCRKCX.RKNO'
      '           Left join ( '
      
        '                  select JGZLS.*,Round(convert(float,JGZLS.JGQty' +
        ')*convert(float,JGDet.Qty),2) as RKQty from ( '
      
        '                  select JGZLS.JGNO,JGZLS.CLBH,JGZLS.ZMLB,JGZLSS' +
        '.ZLBH,JGZLSS.Qty as JGQty'
      '                  from JGZLS,JGZLSS'
      
        '                  where JGZLS.JGNO=JGZLSS.JGNO  and JGZLS.CLBH=J' +
        'GZLSS.CLBH  and JGZLSS.ZLBH='#39'Y1709-0178'#39' and JGZLS.ZMLB<>'#39'ZZZZZZ' +
        'ZZZZ'#39' and JGZLSS.Qty>0 and JGZLS.Qty>0 '
      
        '                  Group by JGZLS.JGNO,JGZLS.CLBH,JGZLS.ZMLB,JGZL' +
        'SS.ZLBH,JGZLSS.Qty) JGZLS '
      
        '                  left join (select JGZLS.JGNO,JGZLS.CLBH,JGZLS.' +
        'ZMLB,JGZLS.Qty from JGZLS,JGZLSS where JGZLS.JGNO=JGZLSS.JGNO an' +
        'd JGZLSS.CLBH=JGZLS.CLBH'
      
        '                             and JGZLSS.ZLBH='#39'Y1709-0178'#39' and JG' +
        'ZLS.ZMLB<>'#39'ZZZZZZZZZZ'#39' and JGZLSS.Qty>0 and JGZLS.Qty>0'
      
        '                             Group by JGZLS.JGNO,JGZLS.CLBH,JGZL' +
        'S.ZMLB,JGZLS.Qty'
      
        '                             ) JGDet on JGDet.JGNO=JGZLS.JGNO an' +
        'd JGDet.ZMLB=JGZLS.ZMLB  and JGDet.CLBH=JGZLS.CLBH '
      
        '            ) JGZLS on KCRKCX.LLNO=JGZLS.JGNO and KCRKCX.CLBH=JG' +
        'ZLS.CLBH and KCRKCX.DFL='#39'JGCK'#39' and KCRKCX.SCBH=JGZLS.ZMLB '
      '           where  KCRKCX.DFL='#39'JGCK'#39' and KCRKCX.RKSB<>'#39'JGRK'#39' '
      
        '                  and exists (select JGZLS.JGNO,JGZLS.CLBH,JGZLS' +
        '.ZMLB  '
      
        '                  from JGZLS,JGZLSS where JGZLS.JGNO=JGZLSS.JGNO' +
        ' and JGZLSS.ZLBH='#39'Y1709-0178'#39' and JGZLS.ZMLB<>'#39'ZZZZZZZZZZ'#39'  '
      
        '                 and JGZLS.JGNO=KCRKCX.LLNO and JGZLS.CLBH=KCRKC' +
        'X.CLBH and JGZLS.ZMLB=KCRKCX.SCBH )'
      
        '           Group by KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.D' +
        'FL,JGZLS.ZLBH,JGZLS.RKQty ) KCRKCX'
      
        '           Group by KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.D' +
        'FL,KCRKCX.ZLBH '
      '           union all'
      
        '           select KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.DFL' +
        ',KCRKCX.ZLBH,null as CNO,Sum(KCRKCX.RKQty) as RKQty,'
      '           null as NK, '
      '           null as HD,'
      '           null as KD, '
      '           null as  XT, '
      '           Sum(KCRKCX.RKQty) as GC,'
      '           null as ZZ '
      
        '           from ( select KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCR' +
        'KCX.DFL,JGZLS.ZLBH,null as CNO,JGZLS.RKQty '
      '           from KCRKCX '
      '           Left join ( '
      
        '                  select JGZLS.*,Round(convert(float,JGZLS.JGQty' +
        ')*convert(float,JGDet.Qty),2) as RKQty from ( '
      
        '                  select JGZLS.JGNO,JGZLS.CLBH,JGZLS.ZMLB,JGZLSS' +
        '.ZLBH,JGZLSS.Qty as JGQty'
      '                  from JGZLS,JGZLSS'
      
        '                  where JGZLS.JGNO=JGZLSS.JGNO and JGZLS.CLBH=JG' +
        'ZLSS.CLBH   and JGZLSS.ZLBH='#39'Y1709-0178'#39' and JGZLS.ZMLB<>'#39'ZZZZZZ' +
        'ZZZZ'#39' and JGZLSS.Qty>0 and JGZLS.Qty>0 '
      
        '                  Group by JGZLS.JGNO,JGZLS.CLBH,JGZLS.ZMLB,JGZL' +
        'SS.ZLBH,JGZLSS.Qty) JGZLS '
      
        '                  left join (select JGZLS.JGNO,JGZLS.CLBH,JGZLS.' +
        'ZMLB,JGZLS.Qty from JGZLS,JGZLSS where JGZLS.JGNO=JGZLSS.JGNO an' +
        'd JGZLSS.CLBH=JGZLS.CLBH'
      
        '                             and JGZLSS.ZLBH='#39'Y1709-0178'#39' and JG' +
        'ZLS.ZMLB<>'#39'ZZZZZZZZZZ'#39' and JGZLSS.Qty>0 and JGZLS.Qty>0'
      
        '                             Group by JGZLS.JGNO,JGZLS.CLBH,JGZL' +
        'S.ZMLB,JGZLS.Qty'
      
        '                             ) JGDet on JGDet.JGNO=JGZLS.JGNO an' +
        'd JGDet.ZMLB=JGZLS.ZMLB  and JGDet.CLBH=JGZLS.CLBH '
      
        '            ) JGZLS on KCRKCX.LLNO=JGZLS.JGNO and KCRKCX.CLBH=JG' +
        'ZLS.CLBH and KCRKCX.DFL='#39'JGCK'#39' and KCRKCX.SCBH=JGZLS.ZMLB '
      '           where  KCRKCX.DFL='#39'JGCK'#39' and KCRKCX.RKSB='#39'JGRK'#39'  '
      
        '                  and exists (select JGZLS.JGNO,JGZLS.CLBH,JGZLS' +
        '.ZMLB  '
      
        '                  from JGZLS,JGZLSS where JGZLS.JGNO=JGZLSS.JGNO' +
        ' and JGZLSS.ZLBH='#39'Y1709-0178'#39' and JGZLS.ZMLB<>'#39'ZZZZZZZZZZ'#39'  '
      
        '                 and JGZLS.JGNO=KCRKCX.LLNO and JGZLS.CLBH=KCRKC' +
        'X.CLBH and JGZLS.ZMLB=KCRKCX.SCBH )'
      
        '           Group by KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.D' +
        'FL,JGZLS.ZLBH,JGZLS.RKQty ) KCRKCX   '
      
        '           Group by KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.D' +
        'FL,KCRKCX.ZLBH '
      '            )'
      
        '             KCRKCX on KCRKCX.LLNO=JGZLS.JGNO and KCRKCX.CLBH=JG' +
        'ZLS.CLBH and KCRKCX.DFL='#39'JGCK'#39' and KCRKCX.SCBH=JGZLS.ZMLB and KC' +
        'RKCX.ZLBH=JGZLSS.ZLBH '
      
        '           where  JGZLSS.ZLBH ='#39'Y1709-0178'#39'  and JGZLS.CLBH like' +
        ' '#39'%'#39' and JGZLS.ZMLB like '#39'%'#39
      
        '           and JGZL.GSBH='#39'VA12'#39' and JGZL.CFMID1<>'#39'NO'#39' and conver' +
        't(smalldatetime,convert(varchar,JGZL.CFMDate1,111))<'#39'2017/09/01'#39
      '           and DDZl.GSBH='#39'VA12'#39' and JGZLS.ZMLB<>'#39'ZZZZZZZZZZ'#39
      
        '           Group by JGZLSS.JGNO,JGZLSS.ZLBH,JGZLS.ZMLB,JGZLS.CLB' +
        'H,KCRKCX.CNO,KCRKCX.RKQty'
      '           ) KCLLS Group by SCBH,CLBH,MJBH,DType'
      
        '          ) KCLLS on KCLLS.SCBH=OrdCL.ZLBH and KCLLS.CLBH=OrdCL.' +
        'CLBH and KCLLS.DType=OrdCL.DType and KCLLS.MJBH=OrdCL.MJBH '
      'where 1=1 '
      ''
      'union all '
      
        'select ZLZLS3.*,KCLLS.TempQty,KCLLS.CNO,KCLLS.RKQty,IsNull(KCLLS' +
        '.NK,0) as NK,IsNull(KCLLS.HD,0) as HD,IsNull(KCLLS.KD,0) as KD,I' +
        'sNull(KCLLS.XT,0) as XT,IsNull(KCLLS.GC,0) as GC,'
      
        '       KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.HD,0)-IsNull(KC' +
        'LLS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLLS.GC,0) as ZZ,KCLLS.Qty'
      ' from ('
      
        'select DDZL.ZLBH1 as ZLBH1,right(ZLZLS3.cldhz,10) as MJBH,right(' +
        'ZLZLS3.cldhz,10) as Parent,'#39'Assembly'#39' as DType,right(ZLZLS3.cldh' +
        'z,10) as cldhz,round(sum(ZLZLS3.TCLYL),2) as TCLYL,'
      
        '      CLZL.ywpm,CLZL.DWBH,XXZL.Article,XXZL.XieMing,ERP_DDZL.Pai' +
        'rs,max(convert(varchar,cast(ZLZLS3.USERDATE as smalldatetime),11' +
        '1)) as CalDate,DDZL.CQDH'
      'FROM LIY_DD.dbo.ZLZLS3  ZLZLS3'
      
        'LEFT JOIN LIY_DD.dbo.DDZL DDZL ON ZLZLS3.DDBH = DDZL.DDBH AND DD' +
        'ZL.CQDH = ZLZLS3.CQDH LEFT JOIN LIY_DD.dbo.CLZL CLZL ON ZLZLS3.c' +
        'ldhz = CLZL.cldh '
      
        'LEFT JOIN LIY_DD.dbo.CLZLSL CLZLSL ON ZLZLS3.cldh = CLZLSL.cldh ' +
        'and ZLZLS3.cldhz=CLZLSL.cldhz '
      
        'left join CLZL ERP_CLZL on ERP_CLZL.CLDH=Substring(ZLZLS3.cldhz,' +
        '2,10)'
      'Left join DDZL ERP_DDZL on ERP_DDZL.DDBH=DDZL.ZLBH1 '
      
        'left join XXZL on ERP_DDZL.XieXing=xxzl.XieXing and ERP_DDZL.She' +
        'hao=xxzl.shehao '
      'where DDZL.ZLBH1='#39'Y1709-0178'#39' and ddzl.CQDH='#39'VR1'#39
      
        'GROUP BY  ZLZLS3.cldhz,DDZL.ZLBH1,CLZL.zwpm,CLZL.ywpm,DDZL.CQDH,' +
        'CLZL.DWBH,XXZL.Article, XXZL.XieMing,ERP_DDZL.Pairs ) ZLZLS3'
      'left join ('
      
        '           select KCLLS.SCBH,KCLLS.CLBH,round(sum(KCLLS.Qty),2) ' +
        'as Qty,round(sum(KCLLS.TempQty),2) as TempQty,'
      
        '                  Max(KCRKCX.CNO) as CNO,Sum(KCRKCX.RKQty) as RK' +
        'Qty,Sum(KCRKCX.NK) as NK,Sum(KCRKCX.HD) as HD,Sum(KCRKCX.KD) as ' +
        'KD,'
      
        #9#9#9#9#9'  Sum(KCRKCX.XT) as XT,Sum(KCRKCX.GC) as GC,Sum(KCRKCX.ZZ) ' +
        'as ZZ '
      '           from KCLLS left join KCLL on KCLL.LLNO=KCLLS.LLNO'
      '           left join ( '
      
        '           select KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.DFL' +
        ',Max(KCRKS.CNO) as CNO,Sum(RKQty) as RKQty,'
      
        '                  Sum(Case when KCRK.HGLB='#39'NK'#39' then RKQty else 0' +
        ' end ) as NK, '
      
        '                  Sum(Case when KCRK.HGLB='#39'HD'#39' then RKQty else 0' +
        ' end ) as HD, '
      
        '                  Sum(Case when KCRK.HGLB='#39'KD'#39' then RKQty else 0' +
        ' end ) as KD, '
      
        '                  Sum(Case when KCRK.HGLB='#39'XT'#39' then RKQty else 0' +
        ' end ) as XT, '
      
        '                  Sum(Case when KCRK.HGLB='#39'GC'#39' then RKQty else 0' +
        ' end ) as GC,'
      
        '                  Sum(Case when KCRK.HGLB='#39'ZZZZ'#39' then RKQty else' +
        ' 0 end ) as ZZ  '
      '           from KCRKCX '
      
        '           Left join KCRKS on KCRKS.RKNO=KCRKCX.RKNO and KCRKS.C' +
        'LBH=KCRKCX.CLBH and KCRKS.CGBH=KCRKCX.CGBH and KCRKS.RKSB=KCRKCX' +
        '.RKSB'
      '           Left join KCRK on KCRK.RKNO=KCRKCX.RKNO'
      
        '           where KCRKCX.SCBH = '#39'Y1709-0178'#39' and KCRKCX.DFL<>'#39'JGC' +
        'K'#39' and KCRKCX.RKSB<>'#39'JGRK'#39' '
      
        '           Group by KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.D' +
        'FL '
      
        '           ) KCRKCX on KCRKCX.LLNO=KCLLS.LLNO and KCRKCX.CLBH=KC' +
        'LLS.CLBH and KCRKCX.DFL=KCLLS.DFL and KCRKCX.SCBH=KCLLS.SCBH    ' +
        '       '
      '           where KCLL.USERDate>getdate()-360'
      '                 and KCLL.GSBH='#39'VR1'#39
      '                 and KCLLS.SCBH ='#39'Y1709-0178'#39'  '
      
        '           group by KCLLS.SCBH,KCLLS.CLBH ) KCLLS on KCLLS.SCBH=' +
        'ZLZLS3.ZLBH1 and KCLLS.CLBH=ZLZLS3.CLDHZ '
      'union all '
      
        'select ZLZLS3.*,KCLLS.TempQty,KCLLS.CNO,KCLLS.RKQty,IsNull(KCLLS' +
        '.NK,0) as NK,IsNull(KCLLS.HD,0) as HD,IsNull(KCLLS.KD,0) as KD,I' +
        'sNull(KCLLS.XT,0) as XT,IsNull(KCLLS.GC,0) as GC,'
      
        '       KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.HD,0)-IsNull(KC' +
        'LLS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLLS.GC,0) as ZZ,KCLLS.Qty'
      ' from ('
      
        'select DDZL.ZLBH1 as ZLBH1,right(ZLZLS3.cldhz,10) as MJBH,right(' +
        'ZLZLS3.cldhz,10) as Parent,'#39'Assembly'#39' as DType,right(ZLZLS3.cldh' +
        'z,10) as cldhz,round(sum(ZLZLS3.TCLYL),2) as TCLYL,'
      
        '      CLZL.ywpm,CLZL.DWBH,XXZL.Article,XXZL.XieMing,ERP_DDZL.Pai' +
        'rs,max(convert(varchar,cast(ZLZLS3.USERDATE as smalldatetime),11' +
        '1)) as CalDate,DDZL.CQDH'
      'FROM LIY_DD.dbo.ZLZLS3  ZLZLS3'
      
        'LEFT JOIN LIY_DD.dbo.DDZL DDZL ON ZLZLS3.DDBH = DDZL.DDBH AND DD' +
        'ZL.CQDH = ZLZLS3.CQDH LEFT JOIN LIY_DD.dbo.CLZL CLZL ON ZLZLS3.c' +
        'ldhz = CLZL.cldh '
      
        'LEFT JOIN LIY_DD.dbo.CLZLSL CLZLSL ON ZLZLS3.cldh = CLZLSL.cldh ' +
        'and ZLZLS3.cldhz=CLZLSL.cldhz '
      
        'left join CLZL ERP_CLZL on ERP_CLZL.CLDH=Substring(ZLZLS3.cldhz,' +
        '2,10)'
      'Left join DDZL ERP_DDZL on ERP_DDZL.DDBH=DDZL.ZLBH1 '
      
        'left join XXZL on ERP_DDZL.XieXing=xxzl.XieXing and ERP_DDZL.She' +
        'hao=xxzl.shehao '
      'where DDZL.ZLBH1='#39'Y1709-0178'#39' and ddzl.CQDH='#39'VR2'#39
      
        'GROUP BY  ZLZLS3.cldhz,DDZL.ZLBH1,CLZL.zwpm,CLZL.ywpm,DDZL.CQDH,' +
        'CLZL.DWBH,XXZL.Article, XXZL.XieMing,ERP_DDZL.Pairs ) ZLZLS3'
      'left join ('
      
        '           select KCLLS.SCBH,KCLLS.CLBH,round(sum(KCLLS.Qty),2) ' +
        'as Qty,round(sum(KCLLS.TempQty),2) as TempQty,'
      
        '                  Max(KCRKCX.CNO) as CNO,Sum(KCRKCX.RKQty) as RK' +
        'Qty,Sum(KCRKCX.NK) as NK,Sum(KCRKCX.HD) as HD,Sum(KCRKCX.KD) as ' +
        'KD,'
      
        #9#9#9#9#9'  Sum(KCRKCX.XT) as XT,Sum(KCRKCX.GC) as GC,Sum(KCRKCX.ZZ) ' +
        'as ZZ '
      '           from KCLLS left join KCLL on KCLL.LLNO=KCLLS.LLNO'
      '           left join ( '
      
        '           select KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.DFL' +
        ',Max(KCRKS.CNO) as CNO,Sum(RKQty) as RKQty,'
      
        '                  Sum(Case when KCRK.HGLB='#39'NK'#39' then RKQty else 0' +
        ' end ) as NK, '
      
        '                  Sum(Case when KCRK.HGLB='#39'HD'#39' then RKQty else 0' +
        ' end ) as HD, '
      
        '                  Sum(Case when KCRK.HGLB='#39'KD'#39' then RKQty else 0' +
        ' end ) as KD, '
      
        '                  Sum(Case when KCRK.HGLB='#39'XT'#39' then RKQty else 0' +
        ' end ) as XT, '
      
        '                  Sum(Case when KCRK.HGLB='#39'GC'#39' then RKQty else 0' +
        ' end ) as GC,'
      
        '                  Sum(Case when KCRK.HGLB='#39'ZZZZ'#39' then RKQty else' +
        ' 0 end ) as ZZ  '
      '           from KCRKCX '
      
        '           Left join KCRKS on KCRKS.RKNO=KCRKCX.RKNO and KCRKS.C' +
        'LBH=KCRKCX.CLBH and KCRKS.CGBH=KCRKCX.CGBH and KCRKS.RKSB=KCRKCX' +
        '.RKSB'
      '           Left join KCRK on KCRK.RKNO=KCRKCX.RKNO'
      
        '           where KCRKCX.SCBH = '#39'Y1709-0178'#39' and KCRKCX.DFL<>'#39'JGC' +
        'K'#39' and KCRKCX.RKSB<>'#39'JGRK'#39' '
      
        '           Group by KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.D' +
        'FL '
      
        '           ) KCRKCX on KCRKCX.LLNO=KCLLS.LLNO and KCRKCX.CLBH=KC' +
        'LLS.CLBH and KCRKCX.DFL=KCLLS.DFL and KCRKCX.SCBH=KCLLS.SCBH    ' +
        '       '
      '           where KCLL.USERDate>getdate()-360'
      '                 and KCLL.GSBH='#39'VR2'#39
      '                 and KCLLS.SCBH ='#39'Y1709-0178'#39'  '
      
        '           group by KCLLS.SCBH,KCLLS.CLBH ) KCLLS on KCLLS.SCBH=' +
        'ZLZLS3.ZLBH1 and KCLLS.CLBH=ZLZLS3.CLDHZ '
      'union all '
      
        'select ZLZLS3.*,KCLLS.TempQty,KCLLS.CNO,KCLLS.RKQty,IsNull(KCLLS' +
        '.NK,0) as NK,IsNull(KCLLS.HD,0) as HD,IsNull(KCLLS.KD,0) as KD,I' +
        'sNull(KCLLS.XT,0) as XT,IsNull(KCLLS.GC,0) as GC,'
      
        '       KCLLS.Qty-IsNull(KCLLS.NK,0)-IsNull(KCLLS.HD,0)-IsNull(KC' +
        'LLS.KD,0)-IsNull(KCLLS.XT,0)-IsNull(KCLLS.GC,0) as ZZ,KCLLS.Qty'
      ' from ('
      
        'select DDZL.ZLBH1 as ZLBH1,right(ZLZLS3.cldhz,10) as MJBH,right(' +
        'ZLZLS3.cldhz,10) as Parent,'#39'Assembly'#39' as DType,right(ZLZLS3.cldh' +
        'z,10) as cldhz,round(sum(ZLZLS3.TCLYL),2) as TCLYL,'
      
        '      CLZL.ywpm,CLZL.DWBH,XXZL.Article,XXZL.XieMing,ERP_DDZL.Pai' +
        'rs,max(convert(varchar,cast(ZLZLS3.USERDATE as smalldatetime),11' +
        '1)) as CalDate,DDZL.CQDH'
      'FROM LIY_DD.dbo.ZLZLS3  ZLZLS3'
      
        'LEFT JOIN LIY_DD.dbo.DDZL DDZL ON ZLZLS3.DDBH = DDZL.DDBH AND DD' +
        'ZL.CQDH = ZLZLS3.CQDH LEFT JOIN LIY_DD.dbo.CLZL CLZL ON ZLZLS3.c' +
        'ldhz = CLZL.cldh '
      
        'LEFT JOIN LIY_DD.dbo.CLZLSL CLZLSL ON ZLZLS3.cldh = CLZLSL.cldh ' +
        'and ZLZLS3.cldhz=CLZLSL.cldhz '
      
        'left join CLZL ERP_CLZL on ERP_CLZL.CLDH=Substring(ZLZLS3.cldhz,' +
        '2,10)'
      'Left join DDZL ERP_DDZL on ERP_DDZL.DDBH=DDZL.ZLBH1 '
      
        'left join XXZL on ERP_DDZL.XieXing=xxzl.XieXing and ERP_DDZL.She' +
        'hao=xxzl.shehao '
      'where DDZL.ZLBH1='#39'Y1709-0178'#39' and ddzl.CQDH='#39'VR3'#39
      
        'GROUP BY  ZLZLS3.cldhz,DDZL.ZLBH1,CLZL.zwpm,CLZL.ywpm,DDZL.CQDH,' +
        'CLZL.DWBH,XXZL.Article, XXZL.XieMing,ERP_DDZL.Pairs ) ZLZLS3'
      'left join ('
      
        '           select KCLLS.SCBH,KCLLS.CLBH,round(sum(KCLLS.Qty),2) ' +
        'as Qty,round(sum(KCLLS.TempQty),2) as TempQty,'
      
        '                  Max(KCRKCX.CNO) as CNO,Sum(KCRKCX.RKQty) as RK' +
        'Qty,Sum(KCRKCX.NK) as NK,Sum(KCRKCX.HD) as HD,Sum(KCRKCX.KD) as ' +
        'KD,'
      
        #9#9#9#9#9'  Sum(KCRKCX.XT) as XT,Sum(KCRKCX.GC) as GC,Sum(KCRKCX.ZZ) ' +
        'as ZZ '
      '           from KCLLS left join KCLL on KCLL.LLNO=KCLLS.LLNO'
      '           left join ( '
      
        '           select KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.DFL' +
        ',Max(KCRKS.CNO) as CNO,Sum(RKQty) as RKQty,'
      
        '                  Sum(Case when KCRK.HGLB='#39'NK'#39' then RKQty else 0' +
        ' end ) as NK, '
      
        '                  Sum(Case when KCRK.HGLB='#39'HD'#39' then RKQty else 0' +
        ' end ) as HD, '
      
        '                  Sum(Case when KCRK.HGLB='#39'KD'#39' then RKQty else 0' +
        ' end ) as KD, '
      
        '                  Sum(Case when KCRK.HGLB='#39'XT'#39' then RKQty else 0' +
        ' end ) as XT, '
      
        '                  Sum(Case when KCRK.HGLB='#39'GC'#39' then RKQty else 0' +
        ' end ) as GC,'
      
        '                  Sum(Case when KCRK.HGLB='#39'ZZZZ'#39' then RKQty else' +
        ' 0 end ) as ZZ  '
      '           from KCRKCX '
      
        '           Left join KCRKS on KCRKS.RKNO=KCRKCX.RKNO and KCRKS.C' +
        'LBH=KCRKCX.CLBH and KCRKS.CGBH=KCRKCX.CGBH and KCRKS.RKSB=KCRKCX' +
        '.RKSB'
      '           Left join KCRK on KCRK.RKNO=KCRKCX.RKNO'
      
        '           where KCRKCX.SCBH = '#39'Y1709-0178'#39' and KCRKCX.DFL<>'#39'JGC' +
        'K'#39' and KCRKCX.RKSB<>'#39'JGRK'#39' '
      
        '           Group by KCRKCX.LLNO,KCRKCX.CLBH,KCRKCX.SCBH,KCRKCX.D' +
        'FL '
      
        '           ) KCRKCX on KCRKCX.LLNO=KCLLS.LLNO and KCRKCX.CLBH=KC' +
        'LLS.CLBH and KCRKCX.DFL=KCLLS.DFL and KCRKCX.SCBH=KCLLS.SCBH    ' +
        '       '
      '           where KCLL.USERDate>getdate()-360'
      '                 and KCLL.GSBH='#39'VR3'#39
      '                 and KCLLS.SCBH ='#39'Y1709-0178'#39'  '
      
        '           group by KCLLS.SCBH,KCLLS.CLBH ) KCLLS on KCLLS.SCBH=' +
        'ZLZLS3.ZLBH1 and KCLLS.CLBH=ZLZLS3.CLDHZ '
      '  ) ZLZLS2 '
      '  Left join CLHG on CLHG.CLBH=ZLZLS2.CLBH'
      '  where 1=1  and IsNull(CNO,'#39#39')<>'#39#39
      ' Group by CNO ')
    Left = 35
    Top = 213
  end
end
